function connectAndSend(e,t,a,n,o,l,i){i||(i=lineLoad);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status?(i&&i(!0),null!=n?n(c.responseText,a):t&&displayMessage(c.responseText),null!=l&&l()):4!=c.readyState&&i&&i(!1)},c.open("POST",BASE_URL+e,!0),c.setRequestHeader("content-type","application/x-www-form-urlencoded"),c.send(o)}function displayMessage(e){var t,a="rgba(102,187,106,1)";console.log(e),e.includes(MESSAGE_ERROR)?a="rgba(244,67,54,1)":e.includes(MESSAGE_INFO)&&(a="rgba(2,136,209,1)"),(t=$(".toast")).find("span").html(e).css({background:a}),t.css({display:"flex"}),t.animate({opacity:"1"},500,function(){setTimeout(function(){t.animate({opacity:"0"}),t.css({display:"none"})},2e3)})}function displayAlert(e,t,a){e||(e="Revise"),t||(t="Asegurate de llenar todos los campos"),a||(a="error"),swal({title:e,text:t,type:a,confirmButtonClass:"btn",buttonsStyling:!1})}function fillCurrentTable(e,t,a){var n;$("html").removeClass("gr__icpayment-soft_com"),void 0!=a?n=$("#"+a+" tbody"):(n=$('[class*="t-"] tbody'),console.log("sin id en la tabla")),n.html(e),t&&t()}function fillClientTable(e,t){fillCurrentTable(e,t,"t-clients")}function fillCajaTable(e,t){fillCurrentTable(e,t,"caja"),t&&t()}function fillPaymentsList(e,t){$(".list-nextpayments").html(e)}function fillAveriasList(e,t){$("#averias-list").html(e),t()}function fillInstallationsList(e,t){$("#installations-list").html(e),t()}function makeContractList(e,t){if("nada"!=e){for(var a,n,o,l,i=JSON.parse(e),c="<option value=''>--Selecciona--</option>",r=i.cliente,s=0;s<i.contratos.length;s++)a=i.contratos[s].id_contrato,n=i.contratos[s].servicio,o=i.contratos[s].nombre_equipo,l=i.contratos[s].router,c+="<option value='"+a+"' data-service='"+n+"'  data-equipment='"+o+"'  data-e-mac='"+i.contratos[s].mac_equipo+"'",c+=" data-router='"+l+"'  data-r-mac='"+i.contratos[s].mac_router+"' data-code='"+i.contratos[s].codigo+"'>",c+=a+"</option>";$("#extra-client-contract").html(c),$("#extra-client-name").val(r.nombres+" "+r.apellidos)}else displayMessage(MESSAGE_ERROR+" Este cliente no existe revise su cedula por favor")}function clearTbody(e){$(e).html("")}function fillClientFields(e,t){if("nada"!=e){var a=JSON.parse(e);$("#averias-client-id").val(a.id_cliente),$("#a-client").val(a.nombres+" "+a.apellidos)}else displayMessage(MESSAGE_ERROR+" Este cliente no existe revise su cedula por favor")}function makePaymentList(e,t){var a=$("#select-pay-until");a.html(e),a.parent().removeClass("hide"),t&&t()}function isEmpty(e,t){for(var a=0;a<e.length;a++)if(null==e[a]||""==e[a])return!0;return!1}function updateSaldo(e){e="RD$ "+CurrencyFormat(e),$(".current-saldo").text(e)}function updateCount(e){$(".total-rows").html(e)}function validateModal(e){var t=$(e+" .password"),a=$(e+" .password-confirm"),n=$(e+" .save");a.on("blur keyup",function(){validateTwo(t,a,n)}),n.on("click",clearForm(e))}function validateTwo(e,t,a){t.val()==e.val()&&""!=t.val()?(replaceClass(e.parent(),"has-error","has-success"),replaceClass(t.parent(),"has-error","has-success"),a.removeAttr("disabled","")):(replaceClass(e.parent(),"has-success","has-error"),replaceClass(t.parent(),"has-success","has-error"),a.attr("disabled",""))}function deleteValidation(e,t,a){var n;this.text=t;var o=this;e.on("keyup",function(e){e.stopImmediatePropagation(),(n=$(this).val()).toLowerCase()==o.text.toLowerCase()?a.removeAttr("disabled"):a.attr("disabled","")})}function validateThis(){var e=$(".password"),t=$(".password-confirm"),a=$(".save");e.on("blur keyup",function(){validateTwo(e,t,a)}),t.on("blur keyup",function(){validateTwo(e,t,a)})}function clearForm(e){$(e+" input").val("")}function replaceClass(e,t,a){e.addClass(a),e.removeClass(t)}function makeServiceCardClickable(){var e=$(".service-card"),t=$("#btn-print-requirement");e.on("click",function(a){a.stopImmediatePropagation();var n=$(this),o=n.attr("data-id"),l=n.attr("data-payment"),i=t.attr("data-href");e.removeClass("selected"),n.addClass("selected"),t.attr("href",i+"/"+o),$("#contract-client-payment").val(l)})}function verifyContractStatus(){$(".td-estado").each(function(e,t){var a=$(this),n=a.text().trim();"activo"==n?a.css({color:"green"}):"saldado"==n&&a.parents("tr").css({background:"rgba(22,255,0,.3)",color:"#555"})})}function verifyClientStatus(){$("td").each(function(e,t){var a=$(this),n=a.text().trim();"no activo"==n?a.css({color:"rgba(200,0,0,.7)"}):"activo"==n&&a.css({color:"green"})})}function heavyLoad(e){function t(){$(".heavy-loader").remove(),$("body").css({overflow:"auto"})}if(e)t();else{var a='<div class="heavy-loader active">';a+='<div class="circle-load"></div>',a+='<div class="message">Preparando los datos</div>',a+="</div>",$("body").append(a),$("body").css({overflow:"hidden"});var n=$(".heavy-loader .message");setTimeout(function(){n.text("Configurando...")},4e3),setTimeout(function(){n.text("Casi Terminamos ...")},8e3),setTimeout(function(){n.text("Terminando el proceso ..."),t()},15e3)}}function lineLoad(e){e?$(".loader").css({display:"none"}):$(".loader").css({display:"block"})}function validatePassword(e){e.length>8&&alert("mayor a 8"),/\d/.test(e)&&alert("tiene digito"),/[a-z]/.test(e)&&alert("tiene minisculas"),/[A-Z]/.test(e)&&alert("tiene mayusculas")}function newContractFunctions(){function e(e){o.removeAttr("checked","").html(""),n.attr("checked","").html("&#10004;"),a.removeClass("print-requirement"),l.removeClass("hide"),i.addClass("hide")}function t(e){n.removeAttr("checked","").html(""),o.attr("checked","").html("&#10004;"),a.addClass("print-requirement"),i.removeClass("hide"),l.addClass("hide")}$("#btn-print-contract");var a=$(".note-item"),n=$("#radio-new-contract"),o=$("#radio-just-requirement"),l=$(".contract-controls"),i=$(".requirement-controls");n.parents("label").on("click",function(){e()}),o.parents("label").on("click",function(){t()})}function detailsFunctions(){$('[role="tab"]').on("click",function(){"#payments"==$(this).attr("href")?$(".payment-controls").addClass("visible"):$(".payment-controls").removeClass("visible"),getTabControls($(this))})}function getTabControls(e){var t=e.attr("aria-controls");$(".dynamic-controls").text(t)}function notificationFunctions(){var e=$("#btn-see-averias"),t=$("#btn-see-pagos"),a=($("#btn-see-caja"),$("#btn-see-deudores")),n=$("#btn-see-day-incomes"),o=$(".layout-container");e.on("click",function(){o.animate({left:"-100%"},200)}),t.on("click",function(){o.animate({left:"0"},200)}),a.on("click",function(){o.animate({left:"-200%"},200)}),n.on("click",function(){o.animate({left:"-300%"},200)})}function checkWindowSize(){var e=window.screen.availWidth,t=document.querySelector(".brand span");t.textContent=e<=1100?"P":"Payment"}function initComponents(){switch(currentPage){case"home":initClientHandlers();break;case"administrador":initAdminHandlers();break;case"clientes":initClientHandlers();break;case"servicios":initServicesHandlers();break;case"nuevo_contrato":initContractHandlers(),Contracts.getIpList();break;case"detalles":initPaymentsHandlers(),detailHandlers();break;case"contratos":initContractHandlers(),initClientHandlers();break;case"cuenta":acountHandlers();break;case"secciones":sectionHandlers()}initCajaHandlers(),initGlobalHandlers()}function initGlobalHandlers(){var e=$("#a-client-dni");"notificaciones"==currentPage&&(Generals.count_table("averias"),$("#averias-view-mode").on("change",function(e){e.stopImmediatePropagation(),Damages.getAll()}),$("#installations-view-mode").on("change",function(e){e.stopImmediatePropagation(),Installations.getAll()}),$("tbody").css({display:"table-row-group"})),"contratos"==currentPage&&initContractHandlers(),$("#btn-save-averia").on("click",function(e){e.stopImmediatePropagation(),Damages.add()}),e.on("keyup",function(t){if(isComplete(e)){var a=getVal(e);Clients.getOne(a,fillClientFields)}else $("#a-client").val("")}),$(".btn-update-averia").on("click",function(e){e.stopImmediatePropagation();var t=$(this).parents(".averia-item").find(".code");t=t.text().trim(),Damages.update(t)}),$(".btn-update-installation").on("click",function(e){e.stopImmediatePropagation();var t=$(this).parents(".averia-item").find(".code");t=t.text().trim(),Installations.update(t)}),$("#extra-controls").on("click",function(e){e.stopImmediatePropagation(),Contracts.btnExtraPressed($(this))}),$("#extra-client-dni").on("keydown",function(e){var t=e.which,a=$(this).val();13==t&&Contracts.getAllOfClient(a)})}function initAdminHandlers(){userTable.init(),$("#btn-save-user").on("click",function(e){e.stopImmediatePropagation(),Users.add()}),$("#btn-update-user").on("click",function(e){e.stopImmediatePropagation(),Users.update()}),$(".delete-user").on("click",function(e){e.preventDefault();var t=$(this).parents("tr").find(".user-id").text().trim(),a=userTable.getRow(t);swal({title:"Está Seguro?",text:"Desea Eliminar al Usuario "+a.nombres+" "+a.apellidos+"?",type:"warning",showCancelButton:!0,confirmButtonText:"Estoy Seguro!",cancelButtonText:"Cancelar"}).then(function(){Users.delete(t)})}),$(".edit-user").on("click",function(e){e.preventDefault();var t=$(this).attr("data-user-id"),a=userTable.getRow(t);$("#e-nickname").val(a.nick),$("#e-name").val(a.nombres),$("#e-lastname").val(a.apellidos),$("#e-dni").val(a.cedula),$("#e-type").val(a.tipo_codigo),$("#update-user-modal").modal()}),$("#update-company-data").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),Company.update()}),$("#btn-update-settings").on("click",function(e){e.preventDefault(),Settings.update()}),$("#btn-save-averia").on("click",function(e){e.stopImmediatePropagation(),Damages.add()})}function initCajaHandlers(){"administrador"==currentPage&&cajaTable.init();var e=$("#btn-add-money"),t=$("#btn-retire-money"),a=$("#caja-user"),n=$("#caja-date");e.on("click",function(e){e.stopImmediatePropagation(),Caja.add()}),t.on("click",function(e){e.stopImmediatePropagation(),Caja.retire()}),n.on("change",function(e){e.stopImmediatePropagation(),Caja.search()}),a.on("change",function(e){e.stopImmediatePropagation(),Caja.search()})}function initClientHandlers(){"clientes"==currentPage&&clientTable.init(),$("#btn-save-client").on("click",function(e){e.stopImmediatePropagation(),Clients.add()}),$("#update-client").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=clientTable.getId();t&&Clients.getOne(t,Clients.receiveForEdit)}),$("#client-searcher").on("keyup",function(e){e.stopImmediatePropagation();var t=$(this).val();Generals.search(t,"clientes",clientTable.refresh)}),$("#client-searcher-newcontract").on("keyup",function(e){e.stopImmediatePropagation();var t=$(this).val();isEmpty([t])?clearTbody(".lobby-results"):Generals.search(t,"clientes",clientTable.refresh)}),$("#delete-client").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=clientTable.getSelectedRow();t&&swal({title:"Está Seguro?",text:"Desea Eliminar al(la) Cliente "+t.nombres+" "+t.apellidos+"?",type:"warning",showCancelButton:!0,confirmButtonText:"Estoy Seguro!",cancelButtonText:"Cancelar"}).then(function(){Generals.deleteRow(t.id,"clientes")})})}function initServicesHandlers(){serviceTable.init(),$("#btn-save-service").on("click",function(e){e.stopImmediatePropagation(),Services.add()}),$("#delete-service").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=serviceTable.getId();t&&swal({title:"Está Seguro?",text:"Desea Eliminar  el Servicio?",type:"warning",showCancelButton:!0,confirmButtonText:"Estoy Seguro!",cancelButtonText:"Cancelar"}).then(function(){Generals.deleteRow(t,"servicios")})}),$("#edit-service").on("click",function(e){e.preventDefault();var t=serviceTable.getSelectedRow();$("#u-service-id").val(t.id),$("#u-service-name").val(t.nombre),$("#u-service-description").val(t.descripcion),$("#u-service-monthly-payment").val(Number(t.mensualidad.replace("RD$ ",""))),$("#u-service-type").val(t.tipo),$("#update-service-modal").modal()}),$("#btn-update-service").on("click",function(e){e.stopImmediatePropagation(),Services.update()}),$("#service-searcher").on("keyup",function(e){e.stopImmediatePropagation();var t=$(this).val();Generals.search(t,"servicios",serviceTable.refresh,initServicesHandlers)})}function initContractHandlers(){contractTable.init(),Contracts.getAll(),$("#btn-save-contract").on("click",function(e){e.stopImmediatePropagation(),Contracts.add()}),$("#btn-add-extra").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),Contracts.callExtra()});$("#contract-searcher").on("keyup",function(e){e.stopImmediatePropagation();var t=$(this).val();Generals.search(t,"v_contratos",contractTable.refresh,null)}),$("#btn-cancel-contract").on("click",function(e){e.preventDefault();var t=contractTable.getSelectedRow();if(t){$(".cancel-name").text(t.cliente);var a=$(".confirmed-data"),n=$("#cancel-permanently");deleteValidation(a,t.cliente,n),$("#cancel-print").attr("href",BASE_URL+"process/getcancelcontract/"+t.id_cliente+"/"+t.id),$("#cancel-contract-modal").modal(),n.on("click",function(e){e.stopImmediatePropagation(),Contracts.cancel(),n.attr("disable")}),a.val(""),n.attr("disabled","")}}),$("#btn-update-contract").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=contractTable.getId();t&&Contracts.getOne(t,Contracts.recieve)}),$("#select-contract-sector").on("change",function(e){e.stopImmediatePropagation(),Contracts.getIpList()}),$("#select-pay-until").on("change",function(e){e.stopImmediatePropagation();var t=$("#select-pay-until :selected").attr("data-contract"),a=$(this).val();Payments.updateUntil(t,a)})}function initPaymentsHandlers(){paymentTable.init(),ran||(Payments.getAll(),ran=!0),$("#btn-pay").on("click",function(e){e.stopImmediatePropagation();var t=paymentTable.getId();t&&Payments.update(t)}),$("#select-contract").on("change",function(e){e.stopImmediatePropagation(),Payments.getAll()})}function detailHandlers(){$("#btn-save-observations").on("click",function(e){e.stopImmediatePropagation(),Clients.saveAbonos()}),$("#btn-save-real-observations").on("click",function(e){e.stopImmediatePropagation(),Clients.saveObservations()}),detailsContractTable.init()}function acountHandlers(){var e=$("#acount-user-id"),t=$("#acount-current-password"),a=$("#update-user-data"),n=$("#acount-new-password");$("#acount-current-password").on("keyup",function(a){a.stopImmediatePropagation(),Users.confirmPassword(e.val(),t.val())}),a.on("click",function(a){a.preventDefault(),a.stopImmediatePropagation(),Users.updatePassword(e.val(),t.val(),n.val())})}function sectionHandlers(){ran||(Sections.getIps(),ran=!0),$("#btn-add-section").on("click",function(e){e.stopImmediatePropagation(),Sections.add()}),$("#select-sector").on("change",function(e){e.stopImmediatePropagation(),Sections.getIps()})}function loginHandlers(){$("#send-credentials").on("click",function(e){e.stopImmediatePropagation(),Session.login()}),$("#user-input").on("keydown",function(e){e.stopImmediatePropagation(),loginLibrary.sendToLogin(e)}),$("#password-input").on("keydown",function(e){e.stopImmediatePropagation(),loginLibrary.sendToLogin(e)}),$("a[href]").on("click",function(){loginLibrary.loading();var e=$(this);try{e.attr("target");setTimeout(function(){$(".loader").css({display:"none"})},3e3)}catch(e){throw e}})}var BASE_URL="http://icpayment-soft.com/",MESSAGE_SUCCESS='<i class="material-icons">done_all</i>',MESSAGE_ERROR='<i class="material-icons">error_outline</i>',MESSAGE_INFO='<i class="material-icons">info_outline</i>',SUMMER_SKY="#1FA1D0";$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(function(){var e=$("title").text().split(" ");"administrador"==(e=e[4].toLowerCase().trim())&&function(){validateModal("#new-user-modal"),validateModal("#update-user-modal")}(),function(){function e(){t=new Date,sDate=t.toString(),n.text(t.getDate()),o.text("De "+r[t.getMonth()]+" de "+t.getFullYear()),l.text(c[t.getDay()]),a=moment().format("LTS"),i.html(a)}var t,a,n=$(".day"),o=$(".month-year"),l=$(".dayweek"),i=$(".hour span"),c=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],r=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];setInterval(e,1e3)}(),function(){$("#company-section").animate({left:"0"},200),$(".administrador .aside-buttons a").on("click",function(e){e.preventDefault();var t=$(this).attr("href").slice(1);null!=t&&($(".company-details").animate({left:"-110%"},200),$("#"+t+".company-details").animate({left:"0"},200))}),$("#acount-section").length>0&&$("#acount-section").animate({left:"0"},200)}(),function(){var e=$(".user-info-tip");$(".profile-picture"),$(".btn-more").on("click",function(t){e.toggleClass("visible")})}(),makeServiceCardClickable(),detailsFunctions(),notificationFunctions(),newContractFunctions(),checkWindowSize(),$(window).on("resize",function(){checkWindowSize()})}),$("#search-client-modal").on("show.bs.modal",function(e){var t=$(e.relatedTarget);clientTable.init();var a=t.find(".section-title").text();a||(a="Buscar Cliente"),"registrar pago"==a.toLowerCase().trim()?buttonText="ir a Pagos":buttonText="Nuevo Contrato";var n=$(this);n.find(".modal-title").text(a),n.find(".modal-footer .save").text(buttonText),n.find("tbody").html("")}),$("#select-extra-service").on("change",function(){var e=$("#select-extra-service :selected").attr("data-payment");$("#extra-service-cost").val(e)}),$("#extra-client-contract").on("change",function(){var e=$("#extra-client-contract :selected");$("#extra-contract-service").val(e.attr("data-service")),$("#extra-equipo").val(e.attr("data-equipment")),$("#extra-router").val(e.attr("data-router")),$("#extra-e-mac").val(e.attr("data-e-mac")),$("#extra-r-mac").val(e.attr("data-r-mac")),$("#extra-code").val(e.attr("data-code"))}),$(".columns-right").removeClass("pull-right"),$("#select-contract-code").on("change",function(){var e=$("#select-contract-code :selected");$("#contract-ip").val(e.attr("data-ip-final")),$("#u-contract-ip").val(e.attr("data-ip-final"))}),$(window).scroll(function(){position=$(window).scrollTop(),movableNav=$(".aside-nav-container, .aside-wide-left"),position>=40?movableNav.addClass("moved"):movableNav.removeClass("moved")});var Users={add:function(){var e,t,a,n,o,l,i;isEmpty([t=$("#user-nickname").val(),a=$("#user-password").val(),n=$("#user-name").val(),o=$("#user-lastname").val(),l=getVal($("#user-dni")),i=$("#user-type").val()])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nickname="+t+"&password="+a+"&name="+n+"&lastname="+o,connectAndSend("user/addnew",!0,initAdminHandlers,null,e+="&dni="+l+"&type="+i,Users.getAll))},update:function(){var e,t,a,n,o,l;isEmpty([t=$("#e-nickname").val(),a=$("#e-name").val(),n=$("#e-lastname").val(),o=$("#e-dni").val(),l=$("#e-type").val()])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nickname="+t+"&name="+a+"&lastname="+n,connectAndSend("user/update",!0,initAdminHandlers,null,e+="&dni="+o+"&type="+l,Users.getAll))},getAll:function(){connectAndSend("user/getusers",!1,initAdminHandlers,userTable.refresh,"table=users",null)},delete:function(e){connectAndSend("user/deleteuser",!0,initAdminHandlers,null,"user_id="+e,Users.getAll)},confirmPassword:function(e,t){function a(e){var t=$("#acount-new-password"),a=$("#acount-confirm-new-password");1==e?(t.removeAttr("disabled"),a.removeAttr("disabled"),validateThis()):(t.attr("disabled",!0),a.attr("disabled",!0))}connectAndSend("user/confirm_password",!1,!1,a,"user_id="+e+"&current_password="+t,null,null)},updatePassword:function(e,t,a){var n="user_id="+e+"&current_password="+t+"&new_password="+a;connectAndSend("user/update_password",!1,!1,Users.passwordChanged,n,null,heavyLoad)},passwordChanged:function(e){1==e?(displayMessage(MESSAGE_SUCCESS+"Contraseña Cambiada con exito"),setTimeout(function(){window.location.href=BASE_URL+"app/logout"},3e3)):displayMessage(MESSAGE_ERROR+" Error al cambiar de contraseña, revise la contraseña actual")}},Clients={add:function(){var e,t,a,n,o,l,i,c,r,s,d,u,p,v;t=$("#client-name").val(),a=$("#client-lastname").val(),n=getVal($("#client-dni")),o=getVal($("#client-phone")),l=$("#client-provincia").val(),i=$("#client-sector").val(),c=$("#client-street").val(),r=$("#client-house").val(),s=getVal($("#client-telephone")),d=$("#client-job").val(),u=getVal($("#client-job-telephone")),p=$("#client-salary").val(),v=moment().format("YYYY-MM-DD"),isEmpty([t,a,n,o,l,i,c,r,s])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nombres="+t+"&apellidos="+a+"&cedula="+n+"&celular="+o,e+="&provincia="+l+"&sector="+i+"&calle="+c+"&casa="+r+"&telefono="+s,e+="&lugar_trabajo="+d+"&tel_trabajo="+u+"&ingresos="+p+"&fecha_registro="+v,connectAndSend("process/add",!0,initClientHandlers,null,e+="&estado=no activo&tabla=clientes",Clients.getAll))},getAll:function(){connectAndSend("process/getall",!1,initClientHandlers,clientTable.refresh,"tabla=clientes",null)},getOne:function(e,t){form="tabla=clientes&id="+e,connectAndSend("process/getone",!1,initClientHandlers,t,form,null)},receiveForEdit:function(e){function t(){isEmpty([n.val(),o.val(),l.val(),i.val(),c.val(),r.val(),s.val(),d.val(),u.val()])?displayAlert("Revise","LLene todos los campos por favor","error"):(form="id="+id+"&nombres="+n.val()+"&apellidos="+o.val()+"&cedula="+getVal(l),form+="&celular="+getVal(i)+"&provincia="+c.val()+"&sector="+r.val()+"&calle="+s.val(),form+="&casa="+d.val()+"&telefono="+getVal(u)+"&lugar_trabajo="+p.val()+"&tel_trabajo =",form+=getVal(v)+"&tabla=clientes",form+="&ingresos="+m.val(),connectAndSend("process/update",!0,initClientHandlers,null,form,Clients.getAll))}var a=JSON.parse(e);this.id=a.id_cliente;var n=$("#u-client-name"),o=$("#u-client-lastname"),l=$("#u-client-dni"),i=$("#u-client-phone"),c=$("#u-client-provincia"),r=$("#u-client-sector"),s=$("#u-client-street"),d=$("#u-client-house"),u=$("#u-client-telephone"),p=$("#u-client-job"),v=$("#u-client-job-telephone"),m=$("#u-client-salary");n.val(a.nombres),o.val(a.apellidos),l.val(a.cedula),i.val(a.celular),c.val(a.provincia),r.val(a.sector),s.val(a.calle),d.val(a.casa),u.val(a.telefono),p.val(a.lugar_trabajo),v.val(a.tel_trabajo),m.val(a.salario),$("#update-client-modal").modal(),$("#btn-update-client").on("click",function(){t()})},saveObservations:function(){abonoValue.find("input").val("RD$ "+CurrencyFormat(abono)),connectAndSend("process/update",!0,null,null,"observaciones="+$("#text-observations").val()+"&tabla=observaciones&id_cliente="+$("#detail-client-id").val(),null)}},Generals={deleteRow:function(e,t){var a,n="tabla="+t+"&id="+e;switch(t){case"clientes":a=Clients.getAll;break;case"servicios":a=Services.getAll}connectAndSend("process/delete",!0,null,null,n,a)},search:function(e,t,a,n){void 0==n&&(n=initClientHandlers),void 0==a&&(a=fillCurrentTable);var o=e;null==o&&""==o||connectAndSend("process/search",!1,n,a,"tabla="+t+"&word="+o,null)},count_table:function(e){var t="tabla="+e,a=updateCount;"caja"==e&&(a=updateCajaCount),connectAndSend("process/count",!1,null,a,t,null)}},Services={add:function(){var e,t,a,n,o;isEmpty([t=$("#service-name").val(),a=$("#service-description").val(),n=$("#service-monthly-payment").val(),o=$("#service-type").val()])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nombre="+t+"&descripcion="+a+"&mensualidad="+n+"&tipo="+o,connectAndSend("process/add",!0,null,null,e+="&tabla=servicios",Services.getAll))},getAll:function(){connectAndSend("process/getall",!1,null,serviceTable.refresh,"tabla=servicios",null)},update:function(){var e,t,a,n,o,l;isEmpty([t=$("#u-service-id").val(),a=$("#u-service-name").val(),n=$("#u-service-description").val(),o=$("#u-service-monthly-payment").val(),l=$("#u-service-type").val()])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="id_servicio="+t+"&nombre="+a+"&descripcion="+n+"&mensualidad="+o,connectAndSend("process/update",!0,null,null,e+="&tipo="+l+"&tabla=servicios",Services.getAll,heavyLoad))}},Contracts={add:function(){var e,t,a,n,o,l,i,c,r,s,d,u,p,v,m;t=$("#contract-client-id").val(),a=$("#contract-user-id").val(),n=$(".service-card.selected").attr("data-id"),l=$("#contract-client-date").val(),c=$("#contract-client-months").val(),r=$("#contract-equipment").val(),s=$("#contract-e-mac").val(),d=$("#contract-router").val(),u=$("#contract-r-mac").val(),v=$("#contract-equipment-model").val(),m=$("#contract-ip").val(),o=$("#select-contract-code").val(),i=$("#contract-client-payment").val(),p=moment(l).add(1,"months").format("YYYY-MM-DD"),isEmpty([t,a,n,l,c])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="id_empleado="+a+"&id_cliente="+t+"&id_servicio="+n+"&codigo="+o+"&fecha="+l,e+="&duracion="+c+"&monto_total="+(Number(c)+1)*Number(i)+"&monto_pagado=0&ultimo_pago=null",e+="&mensualidad="+i+"&proximo_pago="+p+"&estado=activo&tabla=contratos",e+="&nombre_equipo="+r+"&mac_equipo="+s+"&router="+d+"&mac_router="+u,connectAndSend("process/add",!0,null,null,e+="&modelo="+v+"&ip="+m,Contracts.getLast))},extend:function(e){connectAndSend("process/extend",!0,null,null,"id_contrato="+idContrator,null)},getAll:function(){connectAndSend("process/getall",!1,null,contractTable.refresh,"tabla=contratos",null)},getLast:function(e){$("#btn-save-contract").attr("disabled",""),$("#btn-print-contract").removeAttr("disabled"),connectAndSend("process/getlist",!1,null,makePaymentList,"tabla=pagos&id_contrato="+e,null)},callExtra:function(){var e=contractTable.getSelectedRow();e?($("#extra-client-dni").val(e.cedula),Contracts.getAllOfClient(e.cedula),$("#add-extra-modal").modal()):displayAlert("Revise","Seleccione el conrato primero","error")},cancel:function(){var e,t,a=contractTable.getSelectedRow(),n=!1,o=$("#cancelation-reason").val(),l=$("#check-penalty:checked").length;a.id?(l>0&&(n=!0),t=moment().format("YYYY-MM-DD"),e="id_contrato="+a.id+"&fecha="+t+"&id_cliente="+a.id_cliente,connectAndSend("process/cancel",!0,null,null,e+="&motivo="+o+"&penalidad="+n,Contracts.getAll)):displayMessage(MESSAGE_ERROR+" No hay contrato seleccionado")},getOne:function(e,t){form="tabla=contratos&id_contrato="+e,connectAndSend("process/getone",!1,null,t,form,null)},recieve:function(e){function t(e){var t=$("#check-change-ip:checked").length;form="id_contrato="+e+"&nombre_equipo="+n.val()+"&mac_equipo="+o.val(),form+="&router="+l.val()+"&mac_router="+i.val(),form+="&modelo="+c.val(),form+="&tabla=contratos",t>0&&(form+="&ip="+s.val()+"&codigo="+r.val()),connectAndSend("process/update",!0,null,null,form,Contracts.getAll)}var a=JSON.parse(e);this.id_contrato=a.id_contrato;var n=$("#u-contract-equipment"),o=$("#u-contract-e-mac"),l=$("#u-contract-router"),i=$("#u-contract-r-mac"),c=$("#u-contract-modelo"),r=$("#select-contract-code"),s=($("#check-change-ip"),$("#u-contract-ip"));n.val(a.nombre_equipo),o.val(a.mac_equipo),l.val(a.router),i.val(a.mac_router),c.val(a.modelo),s.val(a.ip),$("#update-contract-modal").modal(),$("#update-contract").on("click",function(e){e.stopImmediatePropagation(),t(id_contrato)})},getIpList:function(){function e(e){$("#select-contract-code").html(e)}connectAndSend("process/getall",!1,null,e,"id_seccion="+$("#select-contract-sector").val()+"&tabla=ip_list",null)},btnExtraPressed:function(e){switch(e.text().trim().toLowerCase()){case"mejorar":Contracts.upgrade();break;case"extender":Contracts.extend();break;case"guardar":Contracts.addExtra()}},upgrade:function(){var e,t,a,n;isEmpty([e=$("#extra-client-contract").val(),a=(t=$(".service-card.selected")).attr("data-id"),n=t.attr("data-payment")])?displayAlert("Revise","asegurate de llenar todos los datos y seleccionar el servicio","info"):connectAndSend("process/upgrade",!0,initGlobalHandlers,null,"id_contrato="+e+"&id_servicio="+a+"&cuota="+n,Contracts.getAll)},addExtra:function(){var e,t,a,n,o,l,i,c;t=$("#extra-client-contract").val(),n=$("#extra-service-cost").val(),a=$("#select-extra-service").val(),o=$("#extra-equipo").val(),l=$("#extra-e-mac").val(),i=$("#extra-router").val(),c=$("#extra-r-mac").val(),isEmpty([t,a,n])?displayAlert("revise","asegurate de llenar todos los datos y seleccionar el servicio","info"):(e="id_contrato="+t+"&costo_servicio="+n+"&nombre_servicio="+a,connectAndSend("process/addextra",!0,initGlobalHandlers,null,e+="&nombre_equipo="+o+"&mac_equipo="+l+"&router="+i+"&mac_router="+c,Contracts.getAll))},extend:function(){var e,t;e=$("#extra-client-contract").val(),isEmpty([t=$("#extra-extension-months").val(),e])?displayAlert("revise","asegurate de llenar todos los datos y seleccionar el servicio","info"):connectAndSend("process/extend_contract",!0,initGlobalHandlers,null,"id_contrato="+e+"&duracion="+t,Contracts.getAll)},getAllOfClient:function(e){connectAndSend("process/data_for_extra",!1,null,makeContractList,"dni="+e,null)}},Payments={getAll:function(){var e=$("#select-contract").val();if(null!=e){var t="tabla=pagos&id="+e;connectAndSend("process/getall",!1,null,paymentTable.refresh,t,Payments.contractRefresh)}},update:function(e){connectAndSend("process/update",!0,null,null,"tabla=pagos&id="+e+"&estado=pagado&fecha_pago="+moment().format("YYYY-MM-DD")+"&id_contrato="+$("#select-contract").val(),Payments.getAll)},saveAbonos:function(e){var t,a,n;a=$("#text-abono-detail").val(),n=$("#select-contract").val(),$inputAbono=$("#input-abono"),abono=$inputAbono.val(),t="observaciones="+a+"&abonos="+abono,connectAndSend("process/update",!0,null,null,t+="&contrato_abono="+n+"&tabla=abonos",null),$inputAbono.val("")},updateUntil:function(e,t){$("#select-contract").val();connectAndSend("process/update",!0,null,null,"tabla=pagos_al_dia&id_ultimo_pago="+t+"&estado=pagado&id_contrato="+e,null,heavyLoad)},removePayment:function(e){connectAndSend("process/update",!0,null,null,"tabla=deshacer_pago&id_pago="+e,Payments.getAll)},contractRefresh:function(){var e="tabla=contratos_cliente&id="+$("#detail-client-id").val();connectAndSend("process/getall",!1,null,detailsContractTable.refresh,e,null)},getOne:function(e,t){form="tabla=pagos&id_pago="+e,connectAndSend("process/getone",!1,null,t,form,null)},receiveForEdit:function(e){function t(e){var t=moment().format("YYYY-MM-DD");form="id_pago="+e+"&id_contrato="+id_contrato+"&cuota="+l.val(),form+="&mora="+i.val()+"&monto_extra="+c.val(),form+="&total="+r.val()+"&descuento="+s.val()+"&razon_descuento="+d.val()+"&fecha_pago="+t,form+="&tabla=discount_pagos",connectAndSend("process/update",!0,null,null,form,Payments.getAll),u.hide()}var a=JSON.parse(e);this.id_contrato=a.id_contrato,this.id_pago=a.id_pago;var n=$("#payment-concept"),o=$("#payment-limit-date"),l=$("#payment-cuota"),i=$("#payment-mora"),c=$("#payment-extra"),r=$("#payment-total"),s=$("#payment-discount-amount"),d=$("#payment-discount-reason"),u=$("#advanced-payment");n.val(a.concepto),o.val(a.fecha_limite),l.val(a.cuota),i.val(a.mora),c.val(a.monto_extra),r.val(a.total),function(){$(".payment-sumandos").on("keyup",function(){l.val(a.cuota-s.val());var e=Number(l.val())+Number(i.val())+Number(c.val());r.val(Number(e))})}(),u.modal(),u.on("hide.bs.modal",function(){u.find("input").val("")}),$("#btn-apply-discount").on("click",function(e){e.stopImmediatePropagation(),swal({title:"Está Seguro?",text:"Seguro de que quiere aplicar este descuento de "+s.val()+"?",type:"warning",showCancelButton:!0,confirmButtonText:"Estoy Seguro!",cancelButtonText:"Cancelar"}).then(function(){t(id_pago),u.hide(),u.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()})})}},Damages={add:function(){var e,t;isEmpty([e=$("#averias-client-id").val(),t=$("#a-description").val()])?displayAlert("Revise","LLene todos los campos por favor","error"):connectAndSend("process/add",!0,initGlobalHandlers,null,"id_cliente="+e+"&descripcion="+t+"&tabla=averias",Damages.getAll),$("#new-averia-modal").find("input,textarea").val("")},getAll:function(){var e=$("#averias-view-mode").val();$(".presentado").text(e),connectAndSend("process/getall",!1,initGlobalHandlers,fillAveriasList,"tabla=averias&estado="+e,null)},update:function(e){connectAndSend("process/update",!0,initGlobalHandlers,null,"tabla=averias&id_averia="+e,Damages.getAll)}},Installations={getAll:function(){connectAndSend("process/getall",!1,initGlobalHandlers,fillInstallationsList,"tabla=instalaciones&estado="+$("#installations-view-mode").val(),null)},update:function(e){connectAndSend("process/update",!0,initGlobalHandlers,null,"tabla=instalaciones&id_pago="+e,Installations.getAll)}},Caja={add:function(){var e,t,a;e="entrada="+(t=$("#caja-a-amount").val())+"&descripcion="+(a=$("#caja-a-description").val())+"&tabla=caja",isEmpty([t,a])?displayAlert("Revise","LLene todos los campos por favor","error"):connectAndSend("process/add",!0,null,null,e,Caja.getAll)},retire:function(){var e,t,a;e="salida="+(t=$("#caja-r-amount").val())+"&descripcion="+(a=$("#caja-r-description").val()),isEmpty([t,a])?displayAlert("Revise","LLene todos los campos por favor","error"):connectAndSend("process/retire",!0,null,null,e,Caja.getAll)},getAll:function(){connectAndSend("process/getAll",!1,null,cajaTable.refresh,"tabla=caja",Caja.getSaldo)},getSaldo:function(){connectAndSend("process/getone",!1,null,updateSaldo,"tabla=caja",null)},search:function(){var e=$("#caja-date"),t=$("#caja-user"),a=e.val()?e.val():"%",n="tabla=caja&id_empleado="+(t.val()?t.val():"%")+"&fecha="+a;connectAndSend("process/search",!1,null,cajaTable.refresh,n,null)}},Company={update:function(){var e,t=$("#company-name").val(),a=$("#company-statement").val(),n=getVal($("#company-phone1")),o=$("#company-direction").val();e="nombre="+t+"&lema="+a+"&descripcion="+$("#company-description").val()+"&direccion=",connectAndSend("process/update",!0,null,null,e+=o+"&telefono1="+n+"&telefonos="+getVal($("#company-phone2"))+"&tabla=empresa",null)}},Settings={update:function(){var e;e="cargo_mora="+$("#settings-mora").val()+"&fecha_corte="+$("#settings-fecha-corte").val()+"&apertura_caja="+$("#settings-apertura-caja").val(),e+="&penalizacion_cancelacion="+$("#settings-penalizacion-cancelacion").val()+"&meses_por_defecto="+$("#settings-meses-por-defecto").val(),connectAndSend("process/update",!0,null,null,e+="&split_day="+$("#settings-split-day").val()+"&tabla=settings",null)}},Sections={add:function(){function e(e){var t="nombre="+e[0]+"&codigo_area="+e[1];return t+="&tabla=secciones",new Promise(function(e){if(connectAndSend("process/add",!0,!1,null,t,Sections.getAll,heavyLoad))return e()})}swal.setDefaults({input:"text",confirmButtonText:"Next &rarr;",showCancelButton:!0,animation:!1,progressSteps:["1","2","3"]});var t=[{title:"Nombre del sector"},"Codigo del Sector"];swal.queue(t).then(function(t){swal.resetDefaults(),e(t)})},getIps:function(){var e=$("#select-sector").val();if(null!=e){var t="tabla=ips&id="+e;connectAndSend("process/getall",!1,null,Sections.reorderTable,t,null)}},reorderTable:function(e){var t=$("#t-sections");t.bootstrapTable("destroy"),$("#t-sections tbody").html(e),t.bootstrapTable(),t.find("tbody").css({display:"table-row-group"})},getAll:function(){function e(e){$("#select-sector").html(e)}connectAndSend("process/getall",!1,null,e,"tabla=secciones",heavyLoad)}},currentPage=$("title").text().split(" ");currentPage=currentPage[4].toLowerCase().trim();var ran=!1;$(function(){initComponents()});var ran=!1,Session={login:function(){var e=$("#user-input").val(),t=$("#password-input").val();if(isEmpty([e,t]))displayMessage(MESSAGE_ERROR+" LLene todos los campos indicados para ingresar");else{var a="user="+e+"&password="+t;connectAndSend("app/login",!1,!1,Session.processLoginData,a,null,loginLibrary.loading)}},processLoginData:function(e){1==e?window.location.href=BASE_URL+"app/admin/":($(".loader").css({display:"none"}),displayMessage(MESSAGE_INFO+" Usuario y Contraseña no validos"))}},loginLibrary={loading:function(e){e?$(".loader").css({display:"none"}):$(".loader").css({display:"block"})},sendToLogin:function(e){key=e.which,13==key&&Session.login()}};$(function(){loginHandlers()});