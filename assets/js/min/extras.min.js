var listExtras="",reciboReset={id_pago:0,id_contrato:0,id_servicio:0,id_empleado:0,fecha_pago:"",concepto:"extra",detalles_extra:"",cuota:"",mora:"",monto_extra:"",total:"",estado:"",fecha_limite:"",complete_date:"",descuento:"",razon_descuento:"",deuda:"",abono_a:"",tipo:"",generado:""},appPagoExtra=new Vue({el:"#app-pago-extra",data:{recibo:{id_pago:0,id_contrato:0,id_servicio:0,id_empleado:0,fecha_pago:"dd/mm/yyyy",concepto:"extra",detalles_extra:"",cuota:"",mora:"",monto_extra:"",total:"",estado:"",fecha_limite:"",complete_date:"",descuento:"",razon_descuento:"",deuda:"",abono_a:"",tipo:"",generado:""},visible:!1,pagado:!1,extra:{controls:"",id_extra:"",id_servicio:"",checkbox:"",fecha:"",concepto:"",ultimo_pago:"",monto_pagado:"",monto_total:"",estado:""},firstControls:{hide:!1}},filters:{},computed:{url_recibo:function(){return BASE_URL+"process/getrecibo/"+this.recibo.id_pago},hide_recibo:function(){return"pagado"!=this.recibo.estado&&(this.hide_recibo=!0)},isPagado:function(){return this.pagado="pagado"==this.recibo.estado,this.pagado}},methods:{goBack:function(){extraTable.el.parents(".bootstrap-table").removeClass("hide"),this.visible=!1,this.extra={concepto:""},extraTable.refresh(listExtras)},generatePayment:function(){if(this.pagado){var a="data="+JSON.stringify(this.extra),e=axios.post(BASE_URL+"extra/generate_extra_payment",a);e.then(function(a){var e=a.data;displayMessage(e.mensaje),selectExtraPayment.html(e.pagos).change()}),e.catch(function(){})}else displayMessage(MESSAGE_INFO+" Debe realizar este pago antes de crear uno nuevo")},getPayment:function(a){var e="data="+JSON.stringify({id_pago:a}),t=this;axios.post(BASE_URL+"extra/get_payment",e).then(function(a){var e=a.data;e.recibo&&(t.recibo=e.recibo)})},applyPayment:function(){this.sender("extra/apply_payment")},editPayment:function(){this.sender("extra/edit_payment")},sender:function(a){var e=this,t=this.prepareData(),o=t.info,i=t.data,r="data="+JSON.stringify(i)+"&info="+JSON.stringify(o),n=axios.post(BASE_URL+a,r);n.then(function(a){var t=a.data;listExtras=t.extras,e.getPayments(e.extra.id_extra),displayMessage(t.mensaje)}),n.catch(function(a){console.log(a)})},prepareData:function(a){return{data:{concepto:"extra -",detalles_extra:(a=this.recibo).detalles_extra,fecha_pago:a.fecha_pago,cuota:a.cuota,total:a.cuota,estado:"pagado",tipo:a.tipo,generado:!0},info:{id_extra:a.id_extra,id_pago:a.id_pago}}},getPayments:function(a){var e=this,t="data="+JSON.stringify({id_extra:a});axios.post(BASE_URL+"extra/get_extra_payment_of",t).then(function(a){var t=a.data;t.pagos||(e.recibo=reciboReset),selectExtraPayment.html(t.pagos).change()})},deletePayment:function(){var a=this,e=this.recibo,t={id_extra:e.id_extra,id_pago:e.id_pago},o="data="+JSON.stringify(t),i=axios.post(BASE_URL+"extra/delete_payment",o);i.then(function(e){var t=e.data;displayMessage(t.mensaje),a.getPayments(a.extra.id_extra)}),i.catch(function(a){console.log(a)})}}});bus.$on("row-selected",function(a){extraTable.el.parents(".bootstrap-table").addClass("hide"),appPagoExtra.visible=!0,appPagoExtra.extra=a,listExtras=extraTable.el.find("tbody").html(),appPagoExtra.getPayments(a.id_extra)});var selectExtraPayment=$("#select-extra-payment");selectExtraPayment.on("change",function(){var a=selectExtraPayment.val();appPagoExtra.getPayment(a)});