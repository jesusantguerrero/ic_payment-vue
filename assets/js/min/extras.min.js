var listExtras="",reciboReset={id_pago:0,id_contrato:0,id_servicio:0,id_empleado:0,fecha_pago:"",concepto:"extra",detalles_extra:"",cuota:"",mora:"",monto_extra:"",total:"",estado:"",fecha_limite:"",complete_date:"",descuento:"",razon_descuento:"",deuda:"",abono_a:"",tipo:"",generado:""},appPagoExtra=new Vue({el:"#app-pago-extra",data:{recibo:{id_pago:0,id_contrato:0,id_servicio:0,id_empleado:0,fecha_pago:"dd/mm/yyyy",concepto:"extra",detalles_extra:"",cuota:"",mora:"",monto_extra:"",total:"",estado:"",fecha_limite:"",complete_date:"",descuento:"",razon_descuento:"",deuda:"",abono_a:"",tipo:"",generado:""},visible:!1,pagado:!1,extra:{controls:"",id_extra:"",id_servicio:"",checkbox:"",fecha:"",concepto:"",ultimo_pago:"",monto_pagado:"",monto_total:"",estado:""},firstControls:{hide:!1}},filters:{},computed:{url_recibo:function(){return BASE_URL+"process/getrecibo/"+this.recibo.id_pago},hide_recibo:function(){return"pagado"!=this.recibo.estado&&(this.hide_recibo=!0)},isPagado:function(){return this.pagado="pagado"==this.recibo.estado,this.pagado}},methods:{goBack:function(){extraTable.el.parents(".bootstrap-table").removeClass("hide"),this.visible=!1,this.extra={concepto:""},extraTable.refresh(listExtras)},generatePayment:function(){if(this.pagado){var e="data="+JSON.stringify(this.extra),a=axios.post(BASE_URL+"extra/generate_extra_payment",e);a.then(function(e){var a=e.data;displayMessage(a.mensaje),selectExtraPayment.html(a.pagos).change()}),a.catch(function(){})}else displayMessage(MESSAGE_INFO+" Debe realizar este pago antes de crear uno nuevo")},getPayment:function(e){var a="data="+JSON.stringify({id_pago:e}),t=this;axios.post(BASE_URL+"extra/get_payment",a).then(function(e){var a=e.data;a.recibo&&(t.recibo=a.recibo)})},applyPayment:function(){0!=this.recibo.id_pago?this.sender("extra/apply_payment"):displayMessage(MESSAGE_INFO+" Debe generar un pago primero")},editPayment:function(){this.sender("extra/edit_payment")},sender:function(e){var a=this,t=this.prepareData(),o=t.info,i=t.data,r="data="+JSON.stringify(i)+"&info="+JSON.stringify(o),n=axios.post(BASE_URL+e,r);n.then(function(e){var t=e.data;listExtras=t.extras,a.getPayments(a.extra.id_extra),displayMessage(t.mensaje)}),n.catch(function(e){console.log(e)})},prepareData:function(e){return{data:{concepto:"extra -",detalles_extra:(e=this.recibo).detalles_extra,fecha_pago:e.fecha_pago,cuota:e.cuota,total:e.cuota,estado:"pagado",tipo:e.tipo,generado:!0},info:{id_extra:e.id_extra,id_pago:e.id_pago}}},getPayments:function(e){var a=this,t="data="+JSON.stringify({id_extra:e});axios.post(BASE_URL+"extra/get_extra_payment_of",t).then(function(e){var t=e.data;t.pagos||(a.recibo=reciboReset),selectExtraPayment.html(t.pagos).change()})},deletePayment:function(){var e=this,a=this.recibo,t={id_extra:a.id_extra,id_pago:a.id_pago},o="data="+JSON.stringify(t),i=axios.post(BASE_URL+"extra/delete_payment",o);i.then(function(a){var t=a.data;displayMessage(t.mensaje),e.getPayments(e.extra.id_extra)}),i.catch(function(e){console.log(e)})}}});bus.$on("row-selected",function(e){extraTable.el.parents(".bootstrap-table").addClass("hide"),appPagoExtra.visible=!0,appPagoExtra.extra=e,listExtras=extraTable.el.find("tbody").html(),appPagoExtra.getPayments(e.id_extra)});var selectExtraPayment=$("#select-extra-payment");selectExtraPayment.on("change",function(){var e=selectExtraPayment.val();appPagoExtra.getPayment(e)});