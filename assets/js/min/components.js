function getForm(e){return"data="+JSON.stringify(e)}var configMessage={email:"",password:"",device_id:"",country_code:"",send_at:"1 second",expires_at:"1 hour"},configMessagesForm=new Vue({el:"#message-settings-section",data:{config:configMessage},mounted:function(){this.getConfig()},methods:{confirmPhone:function(){},getConfig:function(){var e,t=this;(e=axios.get(BASE_URL+"messages/get_config")).then(function(e){e.data.config&&(t.config=e.data.config)}),e.catch(function(e){console.log(e)})},saveSettings:function(e){var t,i,s;t=this.config,i="data="+JSON.stringify(t),(s=axios.post(BASE_URL+"messages/save_config",i)).then(function(e){displayMessage(e.data.mensaje)}),s.catch(function(e){console.log(e)})}}}),sendMessageApp=new Vue({el:"#send-message-modal",data:{hide_clients:!0,hide_numbers:!0,message_data:{tipo:"",clientes:"",numeros:"",mensaje:""}},mounted:function(){this.initSelect2()},computed:{letters_count:function(){return this.message_data.mensaje.length}},methods:{sendMessage:function(){var e,t;isEmpty([this.message_data.tipo,this.message_data.mensaje])?swal("Campos Requeridos","Por favor selecciones el tipo de mensaje y escriba su mensaje"):(e="data="+JSON.stringify(this.message_data),(t=axios.post(BASE_URL+"messages/send_message",e)).then(function(e){displayMessage(e.data.mensaje)}),t.catch(function(e){console.log(e)}))},initSelect2:function(){var e={dropdownParent:$("#send-message-modal")},t=$("#message-type");t.select2(e);var i={clients:$("#clients-for-message").select2({dropdownParent:$("#send-message-modal"),ajax:{url:BASE_URL+"messages/search_clients",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:30*t.page<e.total_count}}},cache:!0}}),messageType:t};this.selec2Liteners(i)},selec2Liteners:function(e){var t=this;e.messageType.on("select2:select",function(e){e.params.data.element.attributes;var i=e.params.data.id;t.message_data.tipo=i,"otros"==i?(t.hide_clients=!0,t.hide_numbers=!1):"personalizado"==i?(t.hide_numbers=!0,t.hide_clients=!1):(t.hide_clients=!0,t.hide_numbers=!0)}),e.messageType.select2("val","mora"),e.clients.on("select2:select",function(i){for(var s=e.clients.select2("data"),a=[],n=0;n<s.length;n++)a.push({nombre_completo:s[n].text,celular:s[n].id});t.message_data.clientes=a})}}}),ticketListView=new Vue({el:"#averias-list-view",data:{dataSearch:{text:"",state:"por reparar"},tickets:[],hide:!1},mounted:function(){this.itemClickListener();var e=this;busAveria.$on("tickets-listed",function(){e.itemClickListener()})},methods:{search:function(){var e="data="+JSON.stringify(this.dataSearch),t=axios.post(BASE_URL+"api/averias/search",e);t.then(function(e){this.fillAveriasList(e.data)}),t.catch(function(){console.error(res.data.mensaje)})},fillAveriasList:function(e){$("#averia-item-list").html(e),ticketListView.itemClickListener()},itemClickListener:function(){$("#averias-list-view .averia-item").on("click",function(){var e=$(this).find(".code").text().trim();ticketView.getTicket(e)})}}}),emptyTicket={id_averia:"",id_cliente:"",cliente:"",direccion:"",descripcion:"",celular:"",fecha:"",estado:"",fecha_reparacion:"",codigo:""},ticketView=new Vue({el:"#ticket-view",data:{classes:{hide:!0},mode:{newComment:!1,edit:!1},new_comment:"",comments:[],ticket:emptyTicket},created:function(){$("#ticket-view").removeClass("invisible")},methods:{getTicket:function(e){var t="data="+JSON.stringify({id_averia:e});axios.post(BASE_URL+"api/averias/get_averia",t).then(function(e){var t=e.data;ticketView.classes.hide=!1,ticketListView.hide=!0,ticketView.ticket=t.ticket,ticketView.comments=t.comments})},quit:function(){this.ticket=emptyTicket,this.comments=null,this.classes.hide=!0,this.closeCommentMode(),ticketListView.hide=!1},print:function(){print()},startComment:function(){this.mode.newComment=!0},addComment:function(){var e=getForm({id_averia:this.ticket.id_averia,descripcion:this.new_comment}),t=this;axios.post(BASE_URL+"api/averias/add_comment",e).then(function(e){t.getComments(),t.closeCommentMode(),displayMessage(e.data.mensaje)})},_deleteComment:function(e){var t=e.target.parentNode.parentNode,i=e.target.parentNode.attributes["data-id"].value,s=this;t.classList.add("to-delete"),swal({title:"EstÃ¡ Seguro?",text:"Seguro de que eliminar este reporte?",type:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(function(){s.deleteComment(i),t.classList.remove("to-delete")}).catch(function(){t.classList.remove("to-delete")})},deleteComment:function(e){var t=this,i=getForm({id_reporte:e});axios.post(BASE_URL+"api/averias/delete_comment",i).then(function(e){t.getComments(),displayMessage(e.data.mensaje)})},editComment:function(){},closeCommentMode:function(){this.mode.newComment=!1,this.new_comment=""},getComments:function(){var e=getForm({id_averia:this.ticket.id_averia}),t=this;axios.post(BASE_URL+"api/averias/get_comments",e).then(function(e){t.comments=e.data.comments})},updateDescription:function(){this.updateTicket(["id_averia","descripcion"])},updateTicket:function(e){this.closeEditMode();var t=getForm(this.getFields(e));axios.post(BASE_URL+"api/averias/update_averia",t).then(function(e){ticketListView.search(),displayMessage(e.data.mensaje)})},deleteTicket:function(){console.info("deleted")},closeEditMode:function(){this.mode.edit=!1},enterEditMode:function(){this.mode.edit=!0},getFields:function(e){var t={},i=this;return e.forEach(function(e){t[e]=i.ticket[e]},this),t}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRpY2tldHMuanMiLCJNZXNzYWdlcy5qcyJdLCJuYW1lcyI6WyJnZXRGb3JtIiwib2JqZWN0IiwiSlNPTiIsInN0cmluZ2lmeSIsImNvbmZpZ01lc3NhZ2UiLCJlbWFpbCIsInBhc3N3b3JkIiwiZGV2aWNlX2lkIiwiY291bnRyeV9jb2RlIiwic2VuZF9hdCIsImV4cGlyZXNfYXQiLCJjb25maWdNZXNzYWdlc0Zvcm0iLCJWdWUiLCJlbCIsImRhdGEiLCJjb25maWciLCJtb3VudGVkIiwidGhpcyIsImdldENvbmZpZyIsIm1ldGhvZHMiLCJjb25maXJtUGhvbmUiLCJzZW5kIiwic2VsZiIsImF4aW9zIiwiZ2V0IiwiQkFTRV9VUkwiLCJ0aGVuIiwicmVzIiwiY2F0Y2giLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJzYXZlU2V0dGluZ3MiLCJlIiwiZm9ybSIsInBvc3QiLCJkaXNwbGF5TWVzc2FnZSIsIm1lbnNhamUiLCJlcnIiLCJzZW5kTWVzc2FnZUFwcCIsImhpZGVfY2xpZW50cyIsImhpZGVfbnVtYmVycyIsIm1lc3NhZ2VfZGF0YSIsInRpcG8iLCJjbGllbnRlcyIsIm51bWVyb3MiLCJpbml0U2VsZWN0MiIsImNvbXB1dGVkIiwibGV0dGVyc19jb3VudCIsImxlbmd0aCIsInNlbmRNZXNzYWdlIiwiaXNFbXB0eSIsInN3YWwiLCJvcHRpb25zIiwiZHJvcGRvd25QYXJlbnQiLCIkIiwic2VsZWN0TWVzc2FnZVR5cGUiLCJzZWxlY3QyIiwic2VsZWN0cyIsImNsaWVudHMiLCJhamF4IiwidXJsIiwiZGF0YVR5cGUiLCJkZWxheSIsInBhcmFtcyIsInEiLCJ0ZXJtIiwicGFnZSIsInByb2Nlc3NSZXN1bHRzIiwicmVzdWx0cyIsIml0ZW1zIiwicGFnaW5hdGlvbiIsIm1vcmUiLCJ0b3RhbF9jb3VudCIsImNhY2hlIiwibWVzc2FnZVR5cGUiLCJzZWxlYzJMaXRlbmVycyIsIm9uIiwiZWxlbWVudCIsImF0dHJpYnV0ZXMiLCJpZCIsImkiLCJwdXNoIiwibm9tYnJlX2NvbXBsZXRvIiwidGV4dCIsImNlbHVsYXIiLCJ0aWNrZXRMaXN0VmlldyIsImRhdGFTZWFyY2giLCJzdGF0ZSIsInRpY2tldHMiLCJoaWRlIiwiaXRlbUNsaWNrTGlzdGVuZXIiLCJidXNBdmVyaWEiLCIkb24iLCJzZWFyY2giLCJmaWxsQXZlcmlhc0xpc3QiLCIkY29udGVudCIsImh0bWwiLCJpZF9hdmVyaWEiLCJmaW5kIiwidHJpbSIsInRpY2tldFZpZXciLCJnZXRUaWNrZXQiLCJlbXB0eVRpY2tldCIsImlkX2NsaWVudGUiLCJjbGllbnRlIiwiZGlyZWNjaW9uIiwiZGVzY3JpcGNpb24iLCJmZWNoYSIsImVzdGFkbyIsImZlY2hhX3JlcGFyYWNpb24iLCJjb2RpZ28iLCJjbGFzc2VzIiwibW9kZSIsIm5ld0NvbW1lbnQiLCJlZGl0IiwibmV3X2NvbW1lbnQiLCJjb21tZW50cyIsInRpY2tldCIsImNyZWF0ZWQiLCJyZW1vdmVDbGFzcyIsInF1aXQiLCJjbG9zZUNvbW1lbnRNb2RlIiwicHJpbnQiLCJzdGFydENvbW1lbnQiLCJhZGRDb21tZW50IiwiZ2V0Q29tbWVudHMiLCJfZGVsZXRlQ29tbWVudCIsImNvbW1lbnRJdGVtIiwidGFyZ2V0IiwicGFyZW50Tm9kZSIsImlkQ29tbWVudCIsInZhbHVlIiwiY2xhc3NMaXN0IiwiYWRkIiwidGl0bGUiLCJ0eXBlIiwic2hvd0NhbmNlbEJ1dHRvbiIsImNvbmZpcm1CdXR0b25UZXh0IiwiY2FuY2VsQnV0dG9uVGV4dCIsImRlbGV0ZUNvbW1lbnQiLCJyZW1vdmUiLCJpZF9yZXBvcnRlIiwiZWRpdENvbW1lbnQiLCJ1cGRhdGVEZXNjcmlwdGlvbiIsInVwZGF0ZVRpY2tldCIsImZpZWxkcyIsImNsb3NlRWRpdE1vZGUiLCJnZXRGaWVsZHMiLCJkZWxldGVUaWNrZXQiLCJpbmZvIiwiZW50ZXJFZGl0TW9kZSIsInNlbGVjdGVkRmllbGRzIiwiZm9yRWFjaCIsImZpZWxkIl0sIm1hcHBpbmdzIjoiQUF1TkEsU0FBQUEsUUFBQUMsR0FDQSxN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WyIgIHZhciB0aWNrZXRMaXN0VmlldyA9IG5ldyBWdWUoe1xyXG4gICAgZWw6ICcjYXZlcmlhcy1saXN0LXZpZXcnLFxyXG4gICAgZGF0YToge1xyXG4gICAgICBkYXRhU2VhcmNoOiB7XHJcbiAgICAgICAgdGV4dDogJycsXHJcbiAgICAgICAgc3RhdGU6ICdwb3IgcmVwYXJhcicsXHJcbiAgICAgIH0sXHJcbiAgICAgIHRpY2tldHM6IFtdLFxyXG4gICAgICBoaWRlOiBmYWxzZVxyXG4gICAgfSxcclxuXHJcbiAgICBtb3VudGVkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHRoaXMuaXRlbUNsaWNrTGlzdGVuZXIoKTtcclxuICAgICAgdmFyIHNlbGYgPSB0aGlzXHJcbiAgICAgIGJ1c0F2ZXJpYS4kb24oJ3RpY2tldHMtbGlzdGVkJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYuaXRlbUNsaWNrTGlzdGVuZXIoKVxyXG4gICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICBzZWFyY2g6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZm9ybSA9ICdkYXRhPScgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRhdGFTZWFyY2gpO1xyXG4gICAgICAgIHZhciBzZW5kID0gYXhpb3MucG9zdChCQVNFX1VSTCArICdhcGkvYXZlcmlhcy9zZWFyY2gnLCBmb3JtKTtcclxuXHJcbiAgICAgICAgc2VuZC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgIHRoaXMuZmlsbEF2ZXJpYXNMaXN0KHJlcy5kYXRhKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBzZW5kLmNhdGNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IocmVzLmRhdGEubWVuc2FqZSk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBmaWxsQXZlcmlhc0xpc3Q6IGZ1bmN0aW9uICgkY29udGVudCkge1xyXG4gICAgICAgICQoJyNhdmVyaWEtaXRlbS1saXN0JykuaHRtbCgkY29udGVudCk7XHJcbiAgICAgICAgdGlja2V0TGlzdFZpZXcuaXRlbUNsaWNrTGlzdGVuZXIoKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGl0ZW1DbGlja0xpc3RlbmVyOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCgnI2F2ZXJpYXMtbGlzdC12aWV3IC5hdmVyaWEtaXRlbScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIHZhciBpZF9hdmVyaWEgPSAkKHRoaXMpLmZpbmQoJy5jb2RlJykudGV4dCgpLnRyaW0oKTtcclxuICAgICAgICAgIHRpY2tldFZpZXcuZ2V0VGlja2V0KGlkX2F2ZXJpYSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICB2YXIgZW1wdHlUaWNrZXQgPSB7XHJcbiAgICBcImlkX2F2ZXJpYVwiOiBcIlwiLFxyXG4gICAgXCJpZF9jbGllbnRlXCI6IFwiXCIsXHJcbiAgICBcImNsaWVudGVcIjogXCJcIixcclxuICAgIFwiZGlyZWNjaW9uXCI6IFwiXCIsXHJcbiAgICBcImRlc2NyaXBjaW9uXCI6IFwiXCIsXHJcbiAgICBcImNlbHVsYXJcIjogXCJcIixcclxuICAgIFwiZmVjaGFcIjogXCJcIixcclxuICAgIFwiZXN0YWRvXCI6IFwiXCIsXHJcbiAgICBcImZlY2hhX3JlcGFyYWNpb25cIjogXCJcIixcclxuICAgIFwiY29kaWdvXCI6ICcnLFxyXG4gIH1cclxuICBcclxuICB2YXIgdGlja2V0VmlldyA9IG5ldyBWdWUoe1xyXG4gICAgZWw6ICcjdGlja2V0LXZpZXcnLFxyXG4gICAgXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIGNsYXNzZXM6IHtcclxuICAgICAgICBoaWRlOiB0cnVlXHJcbiAgICAgIH0sXHJcbiAgICAgIG1vZGU6IHtcclxuICAgICAgICBuZXdDb21tZW50OiBmYWxzZSxcclxuICAgICAgICBlZGl0OiBmYWxzZSxcclxuICAgICAgfSxcclxuICAgICAgbmV3X2NvbW1lbnQ6ICcnLFxyXG4gICAgICBjb21tZW50czogW10sXHJcbiAgICAgIHRpY2tldDogZW1wdHlUaWNrZXRcclxuICAgIH0sXHJcbiAgICBjcmVhdGVkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICQoJyN0aWNrZXQtdmlldycpLnJlbW92ZUNsYXNzKCdpbnZpc2libGUnKVxyXG4gICAgfSxcclxuXHJcbiAgICBtZXRob2RzOiB7XHJcbiAgICAgIGdldFRpY2tldDogZnVuY3Rpb24gKGlkX2F2ZXJpYSkge1xyXG4gICAgICAgIHZhciBmb3JtID0gJ2RhdGE9JyArIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgIGlkX2F2ZXJpYTogaWRfYXZlcmlhXHJcbiAgICAgICAgfSlcclxuICAgICAgICB2YXIgc2VuZCA9IGF4aW9zLnBvc3QoQkFTRV9VUkwgKyAnYXBpL2F2ZXJpYXMvZ2V0X2F2ZXJpYScsIGZvcm0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNlbmQudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICB2YXIgZGF0YSA9IHJlcy5kYXRhO1xyXG4gICAgICAgICAgdGlja2V0Vmlldy5jbGFzc2VzLmhpZGUgPSBmYWxzZTtcclxuICAgICAgICAgIHRpY2tldExpc3RWaWV3LmhpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgdGlja2V0Vmlldy50aWNrZXQgPSBkYXRhLnRpY2tldDtcclxuICAgICAgICAgIHRpY2tldFZpZXcuY29tbWVudHMgPSBkYXRhLmNvbW1lbnRzO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBxdWl0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy50aWNrZXQgPSBlbXB0eVRpY2tldDtcclxuICAgICAgICB0aGlzLmNvbW1lbnRzID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNsYXNzZXMuaGlkZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5jbG9zZUNvbW1lbnRNb2RlKCk7XHJcbiAgICAgICAgdGlja2V0TGlzdFZpZXcuaGlkZSA9IGZhbHNlO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgcHJpbnQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBwcmludCgpO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgc3RhcnRDb21tZW50OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlLm5ld0NvbW1lbnQgPSB0cnVlO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgYWRkQ29tbWVudDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmb3JtID0gZ2V0Rm9ybSh7aWRfYXZlcmlhOiB0aGlzLnRpY2tldC5pZF9hdmVyaWEsIGRlc2NyaXBjaW9uOiB0aGlzLm5ld19jb21tZW50fSk7XHJcbiAgICAgICAgdmFyIHNlbmQgPSBheGlvcy5wb3N0KEJBU0VfVVJMICsgJ2FwaS9hdmVyaWFzL2FkZF9jb21tZW50Jyxmb3JtKTtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VuZC50aGVuKCBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICBzZWxmLmdldENvbW1lbnRzKCk7XHJcbiAgICAgICAgICBzZWxmLmNsb3NlQ29tbWVudE1vZGUoKVxyXG4gICAgICAgICAgZGlzcGxheU1lc3NhZ2UocmVzLmRhdGEubWVuc2FqZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBfZGVsZXRlQ29tbWVudDogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICB2YXIgY29tbWVudEl0ZW0gPSBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGVcclxuICAgICAgICB2YXIgaWRDb21tZW50ID0gZS50YXJnZXQucGFyZW50Tm9kZS5hdHRyaWJ1dGVzWydkYXRhLWlkJ10udmFsdWVcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgY29tbWVudEl0ZW0uY2xhc3NMaXN0LmFkZCgndG8tZGVsZXRlJyk7XHJcblxyXG4gICAgICAgIHN3YWwoe1xyXG4gICAgICAgICAgdGl0bGU6ICdFc3TDoSBTZWd1cm8/JyxcclxuICAgICAgICAgIHRleHQ6IFwiU2VndXJvIGRlIHF1ZSBlbGltaW5hciBlc3RlIHJlcG9ydGU/XCIsXHJcbiAgICAgICAgICB0eXBlOiAnd2FybmluZycsXHJcbiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxyXG4gICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdFbGltaW5hcicsXHJcbiAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAnQ2FuY2VsYXInXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbihmdW5jdGlvbigpe1xyXG4gICAgICAgICAgc2VsZi5kZWxldGVDb21tZW50KGlkQ29tbWVudCk7XHJcbiAgICAgICAgICBjb21tZW50SXRlbS5jbGFzc0xpc3QucmVtb3ZlKCd0by1kZWxldGUnKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIGNvbW1lbnRJdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3RvLWRlbGV0ZScpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGRlbGV0ZUNvbW1lbnQ6IGZ1bmN0aW9uIChpZENvbW1lbnQpe1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICB2YXIgZm9ybSA9IGdldEZvcm0oeyBpZF9yZXBvcnRlOiBpZENvbW1lbnR9KTtcclxuICAgICAgICB2YXIgc2VuZCA9IGF4aW9zLnBvc3QoQkFTRV9VUkwgKyAnYXBpL2F2ZXJpYXMvZGVsZXRlX2NvbW1lbnQnLGZvcm0pO1xyXG5cclxuICAgICAgICBzZW5kLnRoZW4oIGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgIHNlbGYuZ2V0Q29tbWVudHMoKTtcclxuICAgICAgICAgIGRpc3BsYXlNZXNzYWdlKHJlcy5kYXRhLm1lbnNhamUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgZWRpdENvbW1lbnQ6IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgIH0sXHJcbiAgICAgIFxyXG4gICAgICBjbG9zZUNvbW1lbnRNb2RlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlLm5ld0NvbW1lbnQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm5ld19jb21tZW50ID0gJyc7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBnZXRDb21tZW50czogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmb3JtID0gZ2V0Rm9ybSh7aWRfYXZlcmlhOiB0aGlzLnRpY2tldC5pZF9hdmVyaWF9KTtcclxuICAgICAgICB2YXIgc2VuZCA9IGF4aW9zLnBvc3QoQkFTRV9VUkwgKyAnYXBpL2F2ZXJpYXMvZ2V0X2NvbW1lbnRzJyxmb3JtKTtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXNcclxuICAgICAgICBzZW5kLnRoZW4oIGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgIHNlbGYuY29tbWVudHMgPSByZXMuZGF0YS5jb21tZW50cztcclxuICAgICAgICB9KTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIHVwZGF0ZURlc2NyaXB0aW9uOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVUaWNrZXQoWydpZF9hdmVyaWEnLCdkZXNjcmlwY2lvbiddKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIHVwZGF0ZVRpY2tldDogZnVuY3Rpb24gKGZpZWxkcykge1xyXG4gICAgICAgIHRoaXMuY2xvc2VFZGl0TW9kZSgpO1xyXG4gICAgICAgIHZhciBmb3JtID0gZ2V0Rm9ybSh0aGlzLmdldEZpZWxkcyhmaWVsZHMpKTtcclxuICAgICAgICB2YXIgc2VuZCA9IGF4aW9zLnBvc3QoQkFTRV9VUkwgKyAnYXBpL2F2ZXJpYXMvdXBkYXRlX2F2ZXJpYScsZm9ybSk7XHJcblxyXG4gICAgICAgIHNlbmQudGhlbiggZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgdGlja2V0TGlzdFZpZXcuc2VhcmNoKCk7XHJcbiAgICAgICAgICBkaXNwbGF5TWVzc2FnZShyZXMuZGF0YS5tZW5zYWplKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBkZWxldGVUaWNrZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ2RlbGV0ZWQnKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGNsb3NlRWRpdE1vZGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLm1vZGUuZWRpdCA9IGZhbHNlO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgZW50ZXJFZGl0TW9kZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMubW9kZS5lZGl0ID0gdHJ1ZTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGdldEZpZWxkczogZnVuY3Rpb24gKGZpZWxkcykge1xyXG4gICAgICAgIHZhciBzZWxlY3RlZEZpZWxkcyA9IHt9O1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICBmaWVsZHMuZm9yRWFjaChmdW5jdGlvbihmaWVsZCkge1xyXG4gICAgICAgICAgc2VsZWN0ZWRGaWVsZHNbZmllbGRdID0gc2VsZi50aWNrZXRbZmllbGRdXHJcbiAgICAgICAgfSwgdGhpcyk7XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxlY3RlZEZpZWxkcztcclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICB9KVxyXG5cclxuICBmdW5jdGlvbiBnZXRGb3JtKG9iamVjdCl7XHJcbiAgICByZXR1cm4gXCJkYXRhPVwiICsgSlNPTi5zdHJpbmdpZnkob2JqZWN0KTtcclxuICB9XHJcbiIsIlxyXG52YXIgY29uZmlnTWVzc2FnZSA9IHtcclxuICBlbWFpbDogJycsXHJcbiAgcGFzc3dvcmQ6ICcnLFxyXG4gIGRldmljZV9pZDogJycsXHJcbiAgY291bnRyeV9jb2RlOiAnJyxcclxuICBzZW5kX2F0OiAnMSBzZWNvbmQnLFxyXG4gIGV4cGlyZXNfYXQ6ICcxIGhvdXInXHJcbn1cclxuXHJcbnZhciBjb25maWdNZXNzYWdlc0Zvcm0gPSBuZXcgVnVlKHtcclxuICBlbDogJyNtZXNzYWdlLXNldHRpbmdzLXNlY3Rpb24nLFxyXG4gIGRhdGE6IHtcclxuICAgIGNvbmZpZzogY29uZmlnTWVzc2FnZVxyXG4gIH0sXHJcbiAgbW91bnRlZDogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5nZXRDb25maWcoKVxyXG4gIH0sXHJcblxyXG4gIG1ldGhvZHM6IHtcclxuICAgIGNvbmZpcm1QaG9uZTogZnVuY3Rpb24gKCkge30sXHJcblxyXG4gICAgZ2V0Q29uZmlnOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHZhciBzZW5kXHJcbiAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgc2VuZCA9IGF4aW9zLmdldChCQVNFX1VSTCArICdtZXNzYWdlcy9nZXRfY29uZmlnJylcclxuICAgICAgc2VuZC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICBpZihyZXMuZGF0YS5jb25maWcpe1xyXG4gICAgICAgICAgc2VsZi5jb25maWcgPSByZXMuZGF0YS5jb25maWdcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIHNlbmQuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICAgIH0pXHJcbiAgICB9LFxyXG5cclxuICAgIHNhdmVTZXR0aW5nczogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgdmFyIGNvbmZpZywgZm9ybSwgc2VuZFxyXG4gICAgICBjb25maWcgPSB0aGlzLmNvbmZpZ1xyXG5cclxuICAgICAgZm9ybSA9ICdkYXRhPScgKyBKU09OLnN0cmluZ2lmeShjb25maWcpXHJcbiAgICAgIHNlbmQgPSBheGlvcy5wb3N0KEJBU0VfVVJMICsgJ21lc3NhZ2VzL3NhdmVfY29uZmlnJywgZm9ybSlcclxuICAgICAgc2VuZC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICBkaXNwbGF5TWVzc2FnZShyZXMuZGF0YS5tZW5zYWplKVxyXG4gICAgICB9KVxyXG4gICAgICBzZW5kLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG59KVxyXG5cclxudmFyIHNlbmRNZXNzYWdlQXBwID0gbmV3IFZ1ZSh7XHJcbiAgZWw6ICcjc2VuZC1tZXNzYWdlLW1vZGFsJyxcclxuXHJcbiAgZGF0YToge1xyXG4gICAgaGlkZV9jbGllbnRzOiB0cnVlLFxyXG4gICAgaGlkZV9udW1iZXJzOiB0cnVlLFxyXG5cclxuICAgIG1lc3NhZ2VfZGF0YToge1xyXG4gICAgICB0aXBvOiAnJyxcclxuICAgICAgY2xpZW50ZXM6ICcnLFxyXG4gICAgICBudW1lcm9zOiAnJyxcclxuICAgICAgbWVuc2FqZTogJydcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBtb3VudGVkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmluaXRTZWxlY3QyKClcclxuICB9LFxyXG5cclxuICBjb21wdXRlZDoge1xyXG4gICAgbGV0dGVyc19jb3VudDogZnVuY3Rpb24gKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5tZXNzYWdlX2RhdGEubWVuc2FqZS5sZW5ndGhcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBtZXRob2RzOiB7XHJcbiAgICBzZW5kTWVzc2FnZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICB2YXIgZm9ybSwgc2VuZFxyXG5cclxuICAgICAgaWYgKCFpc0VtcHR5KFt0aGlzLm1lc3NhZ2VfZGF0YS50aXBvLCB0aGlzLm1lc3NhZ2VfZGF0YS5tZW5zYWplXSkpIHtcclxuICAgICAgICBmb3JtID0gJ2RhdGE9JyArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVzc2FnZV9kYXRhKVxyXG4gICAgICAgIHNlbmQgPSBheGlvcy5wb3N0KEJBU0VfVVJMICsgJ21lc3NhZ2VzL3NlbmRfbWVzc2FnZScsIGZvcm0pXHJcbiAgICAgICAgc2VuZC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgIGRpc3BsYXlNZXNzYWdlKHJlcy5kYXRhLm1lbnNhamUpXHJcbiAgICAgICAgfSlcclxuICAgICAgICBzZW5kLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzd2FsKCdDYW1wb3MgUmVxdWVyaWRvcycsICdQb3IgZmF2b3Igc2VsZWNjaW9uZXMgZWwgdGlwbyBkZSBtZW5zYWplIHkgZXNjcmliYSBzdSBtZW5zYWplJylcclxuICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBpbml0U2VsZWN0MjogZnVuY3Rpb24gKCkge1xyXG4gICAgICB2YXIgc2VsZiA9IHRoaXNcclxuICAgICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgZHJvcGRvd25QYXJlbnQ6ICQoJyNzZW5kLW1lc3NhZ2UtbW9kYWwnKVxyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgc2VsZWN0TWVzc2FnZVR5cGUgPSAkKCcjbWVzc2FnZS10eXBlJylcclxuICAgICAgc2VsZWN0TWVzc2FnZVR5cGUuc2VsZWN0MihvcHRpb25zKVxyXG4gICAgICB2YXIgc2VsZWN0Q2xpZW50c0Zvck1lc3NhZ2UgPSAkKCcjY2xpZW50cy1mb3ItbWVzc2FnZScpLnNlbGVjdDIoe1xyXG4gICAgICAgIGRyb3Bkb3duUGFyZW50OiAkKCcjc2VuZC1tZXNzYWdlLW1vZGFsJyksXHJcbiAgICAgICAgYWpheDoge1xyXG4gICAgICAgICAgdXJsOiBCQVNFX1VSTCArICdtZXNzYWdlcy9zZWFyY2hfY2xpZW50cycsXHJcbiAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgZGVsYXk6IDI1MCxcclxuICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICBxOiBwYXJhbXMudGVybSxcclxuICAgICAgICAgICAgICBwYWdlOiBwYXJhbXMucGFnZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgIHByb2Nlc3NSZXN1bHRzOiBmdW5jdGlvbiAoZGF0YSwgcGFyYW1zKSB7XHJcbiAgICAgICAgICAgIHBhcmFtcy5wYWdlID0gcGFyYW1zLnBhZ2UgfHwgMVxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgIHJlc3VsdHM6IGRhdGEuaXRlbXMsXHJcbiAgICAgICAgICAgICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgbW9yZTogKHBhcmFtcy5wYWdlICogMzApIDwgZGF0YS50b3RhbF9jb3VudFxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNhY2hlOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgdmFyIHNlbGVjdHMgPSB7XHJcbiAgICAgICAgY2xpZW50czogc2VsZWN0Q2xpZW50c0Zvck1lc3NhZ2UsXHJcbiAgICAgICAgbWVzc2FnZVR5cGU6IHNlbGVjdE1lc3NhZ2VUeXBlXHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zZWxlYzJMaXRlbmVycyhzZWxlY3RzKVxyXG4gICAgfSxcclxuXHJcbiAgICBzZWxlYzJMaXRlbmVyczogZnVuY3Rpb24gKHNlbGVjdHMpIHtcclxuICAgICAgdmFyIHNlbGYgPSB0aGlzXHJcbiAgICAgIHNlbGVjdHMubWVzc2FnZVR5cGUub24oJ3NlbGVjdDI6c2VsZWN0JywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICB2YXIgc2VsZWN0ID0gZS5wYXJhbXMuZGF0YS5lbGVtZW50XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBzZWxlY3QuYXR0cmlidXRlc1xyXG4gICAgICAgIHZhciB0aXBvID0gZS5wYXJhbXMuZGF0YS5pZFxyXG4gICAgICAgIHNlbGYubWVzc2FnZV9kYXRhLnRpcG8gPSB0aXBvXHJcblxyXG4gICAgICAgIGlmICh0aXBvID09ICdvdHJvcycpIHtcclxuICAgICAgICAgIHNlbGYuaGlkZV9jbGllbnRzID0gdHJ1ZVxyXG4gICAgICAgICAgc2VsZi5oaWRlX251bWJlcnMgPSBmYWxzZVxyXG4gICAgICAgIH0gZWxzZSBpZiAodGlwbyA9PSAncGVyc29uYWxpemFkbycpIHtcclxuICAgICAgICAgIHNlbGYuaGlkZV9udW1iZXJzID0gdHJ1ZVxyXG4gICAgICAgICAgc2VsZi5oaWRlX2NsaWVudHMgPSBmYWxzZVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBzZWxmLmhpZGVfY2xpZW50cyA9IHRydWVcclxuICAgICAgICAgIHNlbGYuaGlkZV9udW1iZXJzID0gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuXHJcbiAgICAgIHNlbGVjdHMubWVzc2FnZVR5cGUuc2VsZWN0MigndmFsJywnbW9yYScpO1xyXG5cclxuICAgICAgc2VsZWN0cy5jbGllbnRzLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgdmFyIGNsaWVudGVzID0gc2VsZWN0cy5jbGllbnRzLnNlbGVjdDIoJ2RhdGEnKVxyXG4gICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2xpZW50ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGl0ZW1zLnB1c2goe1xyXG4gICAgICAgICAgICAnbm9tYnJlX2NvbXBsZXRvJzogY2xpZW50ZXNbaV0udGV4dCxcclxuICAgICAgICAgICAgJ2NlbHVsYXInOiBjbGllbnRlc1tpXS5pZFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5tZXNzYWdlX2RhdGEuY2xpZW50ZXMgPSBpdGVtc1xyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH1cclxufSkiXX0=
