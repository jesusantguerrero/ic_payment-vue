function getContracts(e){var a="dni="+e;connectAndSend("process/data_for_extra",!1,null,makeContracList,a,null)}$(function(){function e(){initPagination("#t-users","users",_),$("#btn-save-user").on("click",function(e){e.stopImmediatePropagation(),i()}),$("#btn-update-user").on("click",function(e){e.stopImmediatePropagation(),c()}),$(".delete-user").on("click",function(e){e.preventDefault();var a=$(this).parents("tr"),t=a.find(".user-id").text().trim();window.confirm("Está seguro de que desea Eliminar al usuario "+a.find("td:nth(3)").text()+"?")&&s(t)}),$(".edit-user").on("click",function(e){e.preventDefault();var a=$(this).parents("tr").find("td");$("#e-nickname").val(a.eq(2).text()),$("#e-name").val(a.eq(3).text()),$("#e-lastname").val(a.eq(4).text()),$("#e-dni").val(a.eq(5).text()),$("#update-user-modal").modal()}),$("#update-company-data").on("click",function(e){e.stopImmediatePropagation()})}function a(){initPagination("#caja","caja",_),d("caja"),$("#btn-add-money").on("click",function(e){e.stopImmediatePropagation(),E()})}function t(){d("clientes"),initPagination("#t-clients","clientes",_),makeRowsClickable(),verifyClientStatus(),$("#btn-save-client").on("click",function(e){e.stopImmediatePropagation(),u()}),$("#update-client").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var a=$("tr.selected");a&&f(a.find(".id_cliente").text().trim(),b)}),$("#client-searcher").on("keyup",function(e){e.stopImmediatePropagation(),m($(this).val(),"clientes",fillCurrentTable)}),$("#client-searcher-newcontract").on("keyup",function(e){e.stopImmediatePropagation();var a=$(this).val();isEmpty([a])?clearTbody(".lobby-results"):m(a,"clientes",fillClientTable)}),$("#delete-client").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var a=$("tr.selected");if(a){var t=a.find(".id_cliente").text().trim();window.confirm("Está seguro de que desea Eliminar al(la) Cliente "+a.find("td:nth(2)").text()+" "+a.find("td:nth(3)").text()+"?")&&h(t,"clientes")}}),$("#a-client-dni").on("keydown",function(e){var a=e.which,t=$(this).val();13==a&&f(t,fillClientFields)}),$("#btn-save-averia").on("click",function(e){k()})}function n(){d("servicios"),initPagination("#t-services","servicios",_),makeRowsClickable(),$("#btn-save-service").on("click",function(e){e.stopImmediatePropagation(),y()}),$("#delete-service").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var a=$("tr.selected");if(a){var t=a.find(".id_servicio").text().trim();window.confirm("Está seguro de que desea Eliminar al(la) Cliente "+a.find("td:nth(2)").text()+" "+a.find("td:nth(3)").text()+"?")&&h(t,"servicios")}}),$("#edit-service").on("click",function(e){e.preventDefault();var a=$("tr.selected").find("td");$("#update-service-modal input");$("#u-service-id").val(a.eq(1).text()),$("#u-service-name").val(a.eq(2).text()),$("#u-service-description").val(a.eq(3).text()),$("#u-service-monthly-payment").val(Number(a.eq(4).text().slice(3))),$("#u-service-type").val(a.eq(5).text()),$("#update-service-modal").modal()}),$("#btn-update-service").on("click",function(e){e.stopImmediatePropagation(),S()})}function o(){initPagination("#t-contracts","v_contratos",_),makeRowsClickable(),$("#btn-save-contract").on("click",function(e){e.stopImmediatePropagation(),x()}),$("#btn-add-extra").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),w()}),$("#contract-searcher").on("keyup",function(e){e.stopImmediatePropagation(),m($(this).val(),"v_contratos",fillCurrentTable)}),$("#btn-cancel-contract").on("click",function(e){e.preventDefault();var a=$("tr.selected"),t=a.find("td");if(void 0!=a){$(".cancel-name").text(t.eq(1).text()),console.log("El nombre a borrar es este "+t.eq(1).text());var n=$(".confirmed-data"),o=$("#cancel-permanently");deleteValidation(n,o),$("#cancel-contract-modal").modal(),o.on("click",function(){j()}),n.val(""),o.attr("disabled","")}})}function l(){Y||(q(),Y=!0),verifyPaymentStatus(),d("pagos_por_contratos"),initPagination("#t-pagos","pagos_por_contrato",_),$("#btn-pay").on("click",function(e){e.stopImmediatePropagation();var a=$("tr.selected");a&&L(a.find(".id_pago").attr("data-id").trim())}),$("#select-contract").on("change",function(e){e.stopImmediatePropagation(),q()}),makeRowsClickable()}function i(){var a,t,n,o,l,i,c;t=$("#user-nickname").val(),n=$("#user-password").val(),o=$("#user-name").val(),l=$("#user-lastname").val(),i=$("#user-dni").val(),c=$("#user-type").val(),isEmpty([t,n,o,l,i,c])?alert("LLene todos los campos por favor"):(a="nickname="+t+"&password="+n+"&name="+o+"&lastname="+l,a+="&dni="+i+"&type="+c,connectAndSend("user/addnew",!0,e,null,a,r))}function c(){var a,t,n,o,l,i;t=$("#e-nickname").val(),n=$("#e-name").val(),o=$("#e-lastname").val(),l=$("#e-dni").val(),i=$("#e-type").val(),isEmpty([t,n,o,l,i])?alert("LLene todos los campos por favor"):(a="nickname="+t+"&name="+n+"&lastname="+o,a+="&dni="+l+"&type="+i,connectAndSend("user/update",!0,e,null,a,r))}function r(){connectAndSend("user/getusers",!1,e,fillCurrentTable,"table=users",null)}function s(a){var t="user_id="+a;connectAndSend("user/deleteuser",!0,e,null,t,r)}function d(e){var a="tabla="+e,t=updateCount;t=updateCajaCount,connectAndSend("process/count",!1,null,t,a,null)}function u(){var e,a,n,o,l,i,c,r,s,d,u,v,m,f;a=$("#client-name").val(),n=$("#client-lastname").val(),o=$("#client-dni").val(),l=$("#client-phone").val(),i=$("#client-provincia").val(),c=$("#client-sector").val(),r=$("#client-street").val(),s=$("#client-house").val(),d=$("#client-telephone").val(),u=$("#client-job").val(),v=$("#client-job-telephone").val(),m=$("#client-salary").val(),f=getNow(),isEmpty([a,n,o,l,i,c,r,s,d])?alert("LLene los campos requeridos por favor"):(e="nombres="+a+"&apellidos="+n+"&cedula="+o+"&celular="+l,e+="&provincia="+i+"&sector="+c+"&calle="+r+"&casa="+s+"&telefono="+d,e+="&lugar_trabajo="+u+"&tel_trabajo="+v+"&ingresos="+m+"&fecha_registro="+f,e+="&estado=no activo&tabla=clientes",connectAndSend("process/add",!0,t,null,e,p))}function v(){connectAndSend("process/getall",!1,t,fillCurrentTable,"tabla=clientes",null)}function p(){connectAndSend("process/lastpage",!1,t,fillCurrentTable,"tabla=clientes",null)}function m(e,a,n){void 0==n&&(n=fillCurrentTable);var o=e;if(null!=o||""!=o){var l="tabla="+a+"&word="+o;connectAndSend("process/search",!1,t,n,l,null)}}function f(e,a){form="tabla=clientes&id="+e,connectAndSend("process/getone",!1,t,a,form,null)}function b(e){function a(){isEmpty([l.val(),i.val(),c.val(),r.val(),s.val(),d.val(),u.val(),p.val(),m.val()])?alert("LLene los campos requeridos por favor"):(form="id="+o+"&nombres="+l.val()+"&apellidos="+i.val()+"&cedula="+c.val(),form+="&celular="+r.val()+"&provincia="+s.val()+"&sector="+d.val()+"&calle="+u.val(),form+="&casa="+p.val()+"&telefono="+m.val()+"&lugar_trabajo="+f.val()+"&tel_trabajo =",form+="&ingresos="+g.val(),form+=b.val()+"&tabla=clientes",connectAndSend("process/update",!0,t,null,form,v))}console.log(e);var n=JSON.parse(e),o=n.id_cliente,l=$("#u-client-name"),i=$("#u-client-lastname"),c=$("#u-client-dni"),r=$("#u-client-phone"),s=$("#u-client-provincia"),d=$("#u-client-sector"),u=$("#u-client-street"),p=$("#u-client-house"),m=$("#u-client-telephone"),f=$("#u-client-job"),b=$("#u-client-job-telephone"),g=$("#u-client-salary");l.val(n.nombres),i.val(n.apellidos),c.val(n.cedula),r.val(n.celular),s.val(n.provincia),d.val(n.sector),u.val(n.calle),p.val(n.casa),m.val(n.telefono),f.val(n.lugar_trabajo),b.val(n.tel_trabajo),g.val(n.salario),$("#update-client-modal").modal(),$("#btn-update-client").on("click",function(){a()})}function g(e){var a,t,n,o,i,c;t=$("#text-observations").val(),i=$("#input-abono"),n=e?0:i.val(),o=$("#detail-client-id").val(),c=$(".abono-value"),void 0!=e?(i.val(n),$(".abono-box").removeClass("have-abono"),e=1):(i.attr("disabled"),$(".abono-box").addClass("have-abono"),e=0),a="observaciones="+t+"&abonos="+n+"&id_cliente="+o+"&modo="+e,a+="&tabla=observaciones",connectAndSend("process/update",!0,l,null,a,null),c.find("input").val("RD$ "+CurrencyFormat(n))}function k(){var e,a,n;a=$("#averias-client-id").val(),n=$("#a-description").val(),console.log(a+" "+n),isEmpty([a,n])?alert("LLene los campos requeridos por favor"):(e="id_cliente="+a+"&descripcion="+n+"&tabla=averias",connectAndSend("process/add",!0,t,null,e,null)),$("#new-averia-modal").find("input,textarea").val("")}function h(e,a){var o,l,i="tabla="+a+"&id="+e;switch(a){case"clientes":o=t,l=v;break;case"servicios":o=n,l=C}connectAndSend("process/delete",!0,o,null,i,l)}function _(i,c,r){var s,d="user/";switch("users"!=r&&(d="process/"),tableFill=fillCurrentTable,r){case"users":s=e;break;case"clientes":s=t;break;case"servicios":s=n;break;case"v_contratos":s=o;break;case"pagos_por_contrato":s=l;break;case"caja":s=a,tableFill=fillCajaTable}var u="table="+r+"&offset="+i+"&perpage="+c;connectAndSend(d+"paginate",!1,s,tableFill,u,null)}function y(){var e,a,t,o,l;a=$("#service-name").val(),t=$("#service-description").val(),o=$("#service-monthly-payment").val(),l=$("#service-type").val(),isEmpty([a,t,o,l])?alert("LLene todos los campos por favor"):(e="nombre="+a+"&descripcion="+t+"&mensualidad="+o+"&tipo="+l,e+="&tabla=servicios",connectAndSend("process/add",!0,n,null,e,C))}function C(){connectAndSend("process/getall",!1,n,fillCurrentTable,"tabla=servicios",null)}function S(){var e,a,t,o,l,i;a=$("#u-service-id").val(),t=$("#u-service-name").val(),o=$("#u-service-description").val(),l=$("#u-service-monthly-payment").val(),i=$("#u-service-type").val(),isEmpty([a,t,o,l,i])?alert("LLene todos los campos por favor "):(e="id_servicio="+a+"&nombre="+t+"&descripcion="+o+"&mensualidad="+l,e+="&tipo="+i+"&tabla=servicios",connectAndSend("process/update",!0,n,null,e,C))}function x(){var e,a,n,o,l,i,c,r,s,d,u,v;a=$("#contract-client-id").val(),n=$("#contract-user-id").val(),o=$(".service-card.selected").attr("data-id"),l=$("#contract-client-date").val(),c=$("#contract-client-months").val(),r=$("#contract-equipment").val(),s=$("#contract-e-mac").val(),d=$("#contract-router").val(),u=$("#contract-r-mac").val(),i=$("#contract-client-payment").val(),v=moment(l).add(1,"months").format("YYYY-MM-DD"),isEmpty([a,n,o,l,c])?alert("LLene los campos requeridos por favor"):(e="id_empleado="+n+"&id_cliente="+a+"&id_servicio="+o+"&fecha="+l,e+="&duracion="+c+"&monto_total="+(Number(c)+1)*Number(i)+"&monto_pagado=0&ultimo_pago=null",e+="&mensualidad="+i+"&proximo_pago="+v+"&estado=activo&tabla=contratos",e+="&nombre_equipo="+r+"&mac_equipo="+s+"&router="+d+"&mac_router="+u,connectAndSend("process/add",!0,t,null,e,P))}function A(){connectAndSend("process/lastpage",!1,o,fillCurrentTable,"tabla=contratos",null)}function P(e){$("#btn-save-contract").attr("disabled",""),$("#btn-print-contract").removeAttr("disabled")}function w(){var e=$("tr.selected");if(void 0!=e){var a=e.find("td.th-client").attr("data-cedula");$("#extra-client-dni").val(a),getContracts(a),$("#add-extra-modal").modal()}else alert("Seleccione el contrato primero")}function j(e){var a,t=$("tr.selected"),n=t.find(".id_contrato").text().trim(),o=t.find(".th-client").attr("data-id-cliente");a="id_contrato="+n+"&fecha="+moment().format("YYYY-MM-DD")+"&id_cliente="+o,connectAndSend("process/cancel",!0,null,null,a,A)}function q(){var e=$("#select-contract").val();if(null!=e){var a="tabla=pagos&id="+e;connectAndSend("process/getall",!1,l,fillCurrentTable,a,null)}}function I(){connectAndSend("process/lastpage",!1,l,fillCurrentTable,"tabla=pagos",null)}function L(e){if(0==$("#input-abono").val()){var a="tabla=pagos&id="+e+"&estado=pagado&fecha_pago="+moment().format("YYYY-MM-DD")+"&id_contrato="+$("#select-contract").val();console.log(a);connectAndSend("process/update",!0,l,null,a,I)}else alert("has click en la zona roja de abono para confirmar que le viste antes de registrar el pago")}function E(){var e,t,n;e="entrada="+(t=$("#caja-a-amount").val())+"&descripcion="+(n=$("#caja-a-description").val())+"&tabla=caja",isEmpty([t,n])?alert("Asegurese de llenar todos los campos por favor"):connectAndSend("process/add",!0,a,null,e,D)}function D(){connectAndSend("process/lastpage",!1,a,fillCajaTable,"tabla=caja",null)}var T=$("title").text().split(" "),Y=!1;switch(T=T[4].toLowerCase().trim()){case"home":t();break;case"administrador":e();break;case"clientes":t();break;case"servicios":n();break;case"nuevo_contrato":o();break;case"detalles":l(),function(){$("#btn-save-observations").on("click",function(e){e.stopImmediatePropagation(),g()}),$(".abono-value").on("click",function(e){e.stopImmediatePropagation(),g(!0)})}(),verifyContractStatus();break;case"contratos":o(),t(),verifyContractStatus()}a()});