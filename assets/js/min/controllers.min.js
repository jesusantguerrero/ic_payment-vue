var Users={add:function(){var e,a,t,n,o,l,c;a=$("#user-nickname").val(),t=$("#user-password").val(),n=$("#user-name").val(),o=$("#user-lastname").val(),l=getVal($("#user-dni")),c=$("#user-type").val();isEmpty([a,t,n,o,l,c])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nickname="+a+"&password="+t+"&name="+n+"&lastname="+o,e+="&dni="+l+"&type="+c,connectAndSend("user/add",!0,initAdminHandlers,null,e,Users.getAll))},update:function(){var e,a,t,n,o,l;a=$("#e-nickname").val(),t=$("#e-name").val(),n=$("#e-lastname").val(),o=$("#e-dni").val(),l=$("#e-type").val();isEmpty([a,t,n,o,l])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nickname="+a+"&name="+t+"&lastname="+n,e+="&dni="+o+"&type="+l,connectAndSend("user/update",!0,initAdminHandlers,null,e,Users.getAll))},getAll:function(){connectAndSend("user/get_users",!1,initAdminHandlers,userTable.refresh,"table=users",null)},delete:function(e){var a="user_id="+e;connectAndSend("user/delete_user",!0,initAdminHandlers,null,a,Users.getAll)},changeState:function(e){var a="user_id="+e,t=this;axios.post(BASE_URL+"user/change_state",a).then(function(e){t.getAll()})}},Clients={add:function(){var e,a,t,n,o,l,c,r,i,s,d,u,v,p,m;a=$("#client-name").val(),t=$("#client-lastname").val(),n=getVal($("#client-dni")),o=getVal($("#client-phone")),l=$("#client-provincia").val(),c=$("#client-sector").val(),r=$("#client-street").val(),i=$("#client-house").val(),s=$("#client-direction-details").val(),d=getVal($("#client-telephone")),u=$("#client-job").val(),v=getVal($("#client-job-telephone")),p=$("#client-salary").val(),m=moment().format("YYYY-MM-DD");isEmpty([a,t,n,o,l,c,r,i,d])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nombres="+a+"&apellidos="+t+"&cedula="+n+"&celular="+o,e+="&provincia="+l+"&sector="+c+"&calle="+r+"&casa="+i+"&telefono="+d,e+="&lugar_trabajo="+u+"&tel_trabajo="+v+"&ingresos="+p+"&fecha_registro="+m,e+="&estado=no activo&detalles_direccion="+s+"&tabla=clientes",connectAndSend("process/add",!0,initClientHandlers,null,e,Clients.getAll))},getAll:function(){connectAndSend("process/getall",!1,initClientHandlers,clientTable.refresh,"tabla=clientes",null)},getOne:function(e,a){form="tabla=clientes&id="+e,connectAndSend("process/getone",!1,initClientHandlers,a,form,null)},receiveForEdit:function(e){var a=JSON.parse(e);this.id=a.id_cliente;var t=$("#u-client-name"),n=$("#u-client-lastname"),o=$("#u-client-dni"),l=$("#u-client-phone"),c=$("#u-client-provincia"),r=$("#u-client-sector"),i=$("#u-client-street"),s=$("#u-client-house"),d=$("#u-client-direction-details"),u=$("#u-client-telephone"),v=$("#u-client-job"),p=$("#u-client-job-telephone"),m=$("#u-client-salary");t.val(a.nombres),n.val(a.apellidos),o.val(a.cedula),l.val(a.celular),c.val(a.provincia),r.val(a.sector),i.val(a.calle),s.val(a.casa),d.val(a.detalles_direccion),u.val(a.telefono),v.val(a.lugar_trabajo),p.val(a.tel_trabajo),m.val(a.salario),$("#update-client-modal").modal(),$("#btn-update-client").on("click",function(){isEmpty([t.val(),n.val(),o.val(),l.val(),c.val(),r.val(),i.val(),s.val(),u.val()])?displayAlert("Revise","LLene todos los campos por favor","error"):(form="id="+id+"&nombres="+t.val()+"&apellidos="+n.val()+"&cedula="+getVal(o),form+="&celular="+getVal(l)+"&provincia="+c.val()+"&sector="+r.val()+"&calle="+i.val(),form+="&casa="+s.val()+"&detalles_direccion="+d.val()+"&telefono="+getVal(u)+"&lugar_trabajo="+v.val()+"&tel_trabajo=",form+=getVal(p)+"&tabla=clientes",form+="&ingresos="+m.val(),connectAndSend("process/update",!0,initClientHandlers,null,form,Clients.getAll))})},saveObservations:function(){var e;e="observaciones="+$("#text-observations").val()+"&tabla=observaciones&id_cliente="+$("#detail-client-id").val(),connectAndSend("process/update",!0,null,null,e,null)},updateState:function(e){form="data="+JSON.stringify(e)+"&module=clientes&action=update",connectAndSend("process/getjson",!0,null,null,form,null)}},Generals={deleteRow:function(e,a){var t,n="tabla="+a+"&id="+e;switch(a){case"clientes":t=Clients.getAll;break;case"servicios":t=Services.getAll}connectAndSend("process/delete",!0,null,null,n,t)},search:function(e,a,t,n){void 0==n&&(n=initClientHandlers),void 0==t&&(t=fillCurrentTable);var o=e;if(null!=o||""!=o){var l="tabla="+a+"&word="+o;connectAndSend("process/search",!1,n,t,l,null)}},count_table:function(e){var a="tabla="+e,t=updateCount;"caja"==e&&(t=updateCajaCount),connectAndSend("process/count",!1,null,t,a,null)}},Services={add:function(){var e,a,t,n,o;a=$("#service-name").val(),t=$("#service-description").val(),n=$("#service-monthly-payment").val(),o=$("#service-type").val();isEmpty([a,t,n,o])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="nombre="+a+"&descripcion="+t+"&mensualidad="+n+"&tipo="+o,e+="&tabla=servicios",connectAndSend("process/add",!0,null,null,e,Services.getAll))},getAll:function(){connectAndSend("process/getall",!1,null,serviceTable.refresh,"tabla=servicios",null)},update:function(){var e,a,t,n,o,l;a=$("#u-service-id").val(),t=$("#u-service-name").val(),n=$("#u-service-description").val(),o=$("#u-service-monthly-payment").val(),l=$("#u-service-type").val();isEmpty([a,t,n,o,l])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="id_servicio="+a+"&nombre="+t+"&descripcion="+n+"&mensualidad="+o,e+="&tipo="+l+"&tabla=servicios",connectAndSend("process/update",!0,null,null,e,Services.getAll,heavyLoad))}},Contracts={add:function(){var e,a,t,n,o,l,c,r,i,s,d,u,v,p,m;a=$("#contract-client-id").val(),t=$("#contract-user-id").val(),n=$(".service-card.selected").attr("data-id"),l=$("#contract-client-date").val(),r=$("#contract-client-months").val(),i=$("#contract-equipment").val(),s=$("#contract-e-mac").val(),d=$("#contract-router").val(),u=$("#contract-r-mac").val(),p=$("#contract-equipment-model").val(),m=$("#contract-ip").val(),o=$("#select-contract-code").val(),c=$("#contract-client-payment").val(),v=moment(l).add(1,"months").format("YYYY-MM-DD");isEmpty([a,t,n,l,r])?displayAlert("Revise","LLene todos los campos por favor","error"):(e="id_empleado="+t+"&id_cliente="+a+"&id_servicio="+n+"&codigo="+o+"&fecha="+l,e+="&duracion="+r+"&monto_total="+(Number(r)+1)*Number(c)+"&monto_pagado=0&ultimo_pago=null",e+="&mensualidad="+c+"&proximo_pago="+v+"&estado=activo&tabla=contratos",e+="&nombre_equipo="+i+"&mac_equipo="+s+"&router="+d+"&mac_router="+u,e+="&modelo="+p+"&ip="+m,connectAndSend("process/add",null,null,Contracts.getLast,e,null))},getAll:function(){var e=null,a=contractTable.refresh;"detalles"==contractTable.el&&(e=Payments.getAll(),a=null),connectAndSend("process/getall",!1,null,a,"tabla=contratos",e)},getLast:function(e){e=JSON.parse(e),displayMessage(e.mensaje),$("#btn-save-contract").attr("disabled",""),$("#btn-print-contract").removeAttr("disabled"),e.tabla_pagos&&makePaymentList(e.tabla_pagos)},callExtra:function(e){var a;(a="details"==e?detailsContractTable.getSelectedRow():contractTable.getSelectedRow())?($("#extra-client-dni").val(a.cedula),Contracts.getAllOfClient(a.cedula),$("#add-extra-modal").modal()):displayAlert("Revise","Seleccione el conrato primero","error")},cancel:function(e,a){var t,n,o=!1,l=$("#cancelation-reason").val(),c=$("#check-penalty:checked").length;console.log(e),e.id?(c>0&&(o=!0),n=moment().format("YYYY-MM-DD"),t="id_contrato="+e.id+"&fecha="+n+"&id_cliente="+e.id_cliente,t+="&motivo="+l+"&penalidad="+o,connectAndSend("process/cancel",!0,null,null,t,a)):displayMessage(MESSAGE_ERROR+" No hay contrato seleccionado")},getOne:function(e,a){form="tabla=contratos&id_contrato="+e,connectAndSend("process/getone",!1,null,a,form,null)},recieve:function(e){var a=JSON.parse(e);this.id_contrato=a.id_contrato;var t=$("#u-contract-equipment"),n=$("#u-contract-e-mac"),o=$("#u-contract-router"),l=$("#u-contract-r-mac"),c=$("#u-contract-modelo"),r=$("#select-contract-code"),i=($("#check-change-ip"),$("#u-contract-ip"));t.val(a.nombre_equipo),n.val(a.mac_equipo),o.val(a.router),l.val(a.mac_router),c.val(a.modelo),i.val(a.ip),$("#update-contract-modal").modal(),$("#update-contract").on("click",function(e){e.stopImmediatePropagation(),function(e){var a=$("#check-change-ip:checked").length;form="id_contrato="+e+"&nombre_equipo="+t.val()+"&mac_equipo="+n.val(),form+="&router="+o.val()+"&mac_router="+l.val(),form+="&modelo="+c.val(),form+="&tabla=contratos",a>0&&(form+="&ip="+i.val()+"&codigo="+r.val()),connectAndSend("process/update",!0,null,null,form,Contracts.getAll)}(id_contrato)})},getIpList:function(){var e="id_seccion="+$("#select-contract-sector").val()+"&tabla=ip_list";connectAndSend("process/getall",!1,null,function(e){$("#select-contract-code").html(e)},e,null)},btnExtraPressed:function(e){switch(e.text().trim().toLowerCase()){case"mejorar":Contracts.upgrade();break;case"extender":Contracts.extend();break;case"guardar":Contracts.addExtra()}},upgrade:function(){var e,a,t,n,o;a=$("#extra-client-contract").val(),n=(t=$(".service-card.selected")).attr("data-id"),o=t.attr("data-payment");isEmpty([a,n,o])?displayAlert("Revise","asegurate de llenar todos los datos y seleccionar el servicio","info"):(e="id_contrato="+a+"&id_servicio="+n+"&cuota="+o,connectAndSend("process/upgrade",!0,initGlobalHandlers,null,e,Contracts.getAll))},reconnect:function(e,a){var t,n,o,l,c,r;n=$(".service-card.selected").attr("data-id"),o=$("#reconnection-months").val(),l=$("#reconnection-date").val(),isEmpty([e,n,l,o])?swal("Llene todos los campos"):(r={id_contrato:e,fecha:l,id_servicio:n,duracion:o},t="data="+JSON.stringify(r),(c=axios.post(BASE_URL+"contract/reconnect",t)).then(function(e){displayMessage(e.data.mensaje),Payments.getAll(),$("#btn-reconnect").removeAttr("disabled"),$(".reconnect-caller").removeClass("visible"),a&&a()}),c.catch(function(e){console.log(e)}))},addExtra:function(){var e,a,t,n,o,l,c,r,i;a=$("#extra-client-contract").val(),n=$("#extra-service-cost").val(),t=$("#select-extra-service").val(),o=$("#extra-equipo").val(),l=$("#extra-e-mac").val(),c=$("#extra-router").val(),r=$("#extra-r-mac").val(),i=$("#select-payment-mode").val();isEmpty([a,t,n,i])?displayAlert("revise","asegurate de llenar todos los datos y seleccionar el servicio","info"):(e="id_contrato="+a+"&costo_servicio="+n+"&nombre_servicio="+t,e+="&nombre_equipo="+o+"&mac_equipo="+l+"&router="+c+"&mac_router="+r,e+="&modo_pago="+i,connectAndSend("process/addextra",!0,initGlobalHandlers,null,e,Contracts.getAll))},extend:function(){var e,a,t;a=$("#extra-client-contract").val(),t=$("#extra-extension-months").val();isEmpty([t,a])?displayAlert("revise","asegurate de llenar todos los datos y seleccionar el servicio","info"):(e="id_contrato="+a+"&duracion="+t,connectAndSend("process/extend_contract",!0,initGlobalHandlers,null,e,Contracts.getAll))},getAllOfClient:function(e){var a="dni="+e,t=this;axios.post(BASE_URL+"process/data_for_extra",a).then(function(e){t.makeContractList(e.data)}).catch(function(){})},suspend:function(e,a){var t="data="+JSON.stringify({id_contrato:e});axios.post(BASE_URL+"contract/suspend",t).then(function(e){var t=e.data;displayMessage(t.mensaje),Contracts.getAll(),a&&a()}).catch(function(e){console.log(e)})},makeContractList:function(e){if(e){var a,t,n,o,l,c,r,i,s=$("#extra-client-contract"),d="<option value=''>--Selecciona--</option>",u=e.cliente,v=e.contratos;"detalles"!=currentPage&&"home"!=currentPage?i=contractTable.getId():"home"!=currentPage&&(i=detailsContractTable.getSelectedRow().id_contrato);for(var p=0;p<v.length;p++)a=v[p].id_contrato,t=v[p].servicio,n=v[p].nombre_equipo,l=v[p].router,o=v[p].mac_equipo,c=v[p].mac_router,r=v[p].codigo,ensurance=v[p].nombre_seguro,ensuranceCost=v[p].mensualidad_seguro,d+="<option value='"+a+"' data-service='"+t+"'  data-equipment='"+n+"'  data-e-mac='"+o+"'",d+=" data-router='"+l+"'  data-r-mac='"+c+"' data-code='"+r+"'>",d+=a+"</option>";s.html(d),s.val(i).change(),$("#extra-client-name").val(u.nombres+" "+u.apellidos)}else displayMessage(MESSAGE_ERROR+" Este cliente no existe revise su cedula por favor")}},Payments={getAll:function(){var e=$("#select-contract").val();if(null!=e){var a="tabla=pagos&id="+e;connectAndSend("process/getall",!1,null,paymentTable.refresh,a,Payments.contractRefresh)}},update:function(e){var a="tabla=pagos&id="+e+"&estado=pagado&fecha_pago="+moment().format("YYYY-MM-DD")+"&id_contrato="+$("#select-contract").val();connectAndSend("process/update",!0,null,null,a,Payments.getAll)},saveAbonos:function(){var e,a,t;a=$("#text-abono-detail").val(),t=$("#select-contract").val(),$inputAbono=$("#input-abono"),abono=$inputAbono.val(),e="observaciones="+a+"&abonos="+abono,e+="&contrato_abono="+t+"&tabla=abonos",connectAndSend("process/update",!0,null,null,e,Payments.getAll),$inputAbono.val("")},saveExtra:function(){axios.post(BASE_URL+"process/")},updateUntil:function(e,a){$("#select-contract").val();var t="tabla=pagos_al_dia&id_ultimo_pago="+a+"&estado=pagado&id_contrato="+e;connectAndSend("process/update",!0,null,null,t,null,heavyLoad)},removePayment:function(e){var a="tabla=deshacer_pago&id_pago="+e;connectAndSend("process/update",!0,null,null,a,Payments.getAll)},contractRefresh:function(){var e="tabla=contratos_cliente&id="+$("#detail-client-id").val();connectAndSend("process/getall",!1,null,detailsContractTable.refresh,e,null)},getOne:function(e,a){form="tabla=pagos&id_pago="+e,connectAndSend("process/getone",!1,null,a,form,null)},receiveForEdit:function(e){function a(){!function(e){var a=moment().format("YYYY-MM-DD");form="id_pago="+e+"&id_contrato="+id_contrato+"&cuota="+i.val(),form+="&mora="+s.val()+"&monto_extra="+d.val(),form+="&total="+u.val()+"&descuento="+v.val()+"&razon_descuento="+p.val(),form+="&fecha_pago="+a+"&detalles_extra="+r.val()+"&tabla=discount_pagos",connectAndSend("process/update",!0,null,null,form,Payments.getAll),m.hide()}(id_pago),m.hide(),m.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}var t=JSON.parse(e),n=t.pago,o=t.settings;this.id_contrato=n.id_contrato,this.id_pago=n.id_pago;var l=$("#payment-concept"),c=$("#payment-limit-date"),r=$("#payment-extra-services"),i=$("#payment-cuota"),s=$("#payment-mora"),d=$("#payment-extra"),u=$("#payment-total"),v=$("#payment-discount-amount"),p=$("#payment-discount-reason"),m=$("#advanced-payment"),f=$("#c_mora"),g=$("#c_reconexion");l.val(n.concepto),c.val(n.fecha_limite),i.val(n.cuota),s.val(n.mora),d.val(n.monto_extra),u.val(n.total),r.val(n.detalles_extra),$(".payment-sumandos").on("keyup",function(){i.val(n.cuota-v.val());var e=Number(i.val())+Number(s.val())+Number(d.val());u.val(Number(e))}),m.modal(),m.on("hide.bs.modal",function(){m.find("input").val("")}),n.mora>0?f.iCheck("check"):f.iCheck("uncheck"),n.detalles_extra.includes("Reconexion")?g.iCheck("check"):g.iCheck("uncheck"),$("#btn-apply-discount").on("click",function(e){e.stopImmediatePropagation(),v.val()>0?swal({title:"Está Seguro?",text:"Seguro de que quiere aplicar este descuento de "+v.val()+"?",type:"warning",showCancelButton:!0,confirmButtonText:"Estoy Seguro!",cancelButtonText:"Cancelar"}).then(function(){a()}):a()}),f.on("ifChecked",function(){var e=n.cuota*o.cargo_mora/100;s.val(e).trigger("keyup")}),g.on("ifChecked",function(){d.val(o.reconexion).trigger("keyup"),r.val("Reconexion")}),f.on("ifUnchecked",function(){s.val(0).trigger("keyup")}),g.on("ifUnchecked",function(){d.val(0).trigger("keyup"),r.val("")})}},Damages={add:function(e){var a,t;t=$("#a-description").val();isEmpty([e,t])?displayAlert("Revise","LLene todos los campos por favor","error"):(a="id_cliente="+e+"&descripcion="+t+"&tabla=averias",connectAndSend("process/add",!0,initGlobalHandlers,null,a,Damages.getAll)),$("#new-averia-modal").find("input,textarea").val("")},getAll:function(){var e=$("#averias-view-mode").val();$(".presentado").text(e);var a="tabla=averias&estado="+e;connectAndSend("process/getall",!1,initGlobalHandlers,fillAveriasList,a,null)},update:function(e){var a="tabla=averias&id_averia="+e;connectAndSend("process/update",!0,initGlobalHandlers,null,a,Damages.getAll)}},Installations={getAll:function(){var e="tabla=instalaciones&estado="+$("#installations-view-mode").val();connectAndSend("process/getall",!1,initGlobalHandlers,fillInstallationsList,e,null)},update:function(e){var a="tabla=instalaciones&id_pago="+e;connectAndSend("process/update",!0,initGlobalHandlers,null,a,Installations.getAll)}},Caja={add:function(){var e,a,t;e="entrada="+(a=$("#caja-a-amount").val())+"&descripcion="+(t=$("#caja-a-description").val())+"&tabla=caja",isEmpty([a,t])?displayAlert("Revise","LLene todos los campos por favor","error"):connectAndSend("process/add",!0,null,null,e,Caja.getAll)},retire:function(){var e,a,t;e="salida="+(a=$("#caja-r-amount").val())+"&descripcion="+(t=$("#caja-r-description").val()),isEmpty([a,t])?displayAlert("Revise","LLene todos los campos por favor","error"):connectAndSend("process/retire",!0,null,null,e,Caja.getAll)},getAll:function(){connectAndSend("process/getAll",!1,null,cajaTable.refresh,"tabla=caja",Caja.getSaldo)},getSaldo:function(){connectAndSend("process/getone",!1,null,updateSaldo,"tabla=caja",null)},search:function(){var e=$("#caja-date"),a=$("#caja-user"),t=e.val()?e.val():"%",n="tabla=caja&id_empleado="+(a.val()?a.val():"%")+"&fecha="+t;connectAndSend("process/search",!1,null,cajaTable.refresh,n,null)}},Company={update:function(){var e,a=$("#company-name").val(),t=$("#company-statement").val(),n=getVal($("#company-phone1")),o=$("#company-direction").val();e="nombre="+a+"&lema="+t+"&descripcion="+$("#company-description").val()+"&direccion=",e+=o+"&telefono1="+n+"&telefonos="+getVal($("#company-phone2"))+"&tabla=empresa",connectAndSend("process/update",!0,null,null,e,null)}},Settings={update:function(){var e;e="cargo_mora="+$("#settings-mora").val()+"&fecha_corte="+$("#settings-fecha-corte").val()+"&reconexion="+$("#settings-reconexion").val(),e+="&penalizacion_cancelacion="+$("#settings-penalizacion-cancelacion").val()+"&meses_por_defecto="+$("#settings-meses-por-defecto").val(),e+="&split_day="+$("#settings-split-day").val()+"&tabla=settings",connectAndSend("process/update",!0,null,null,e,null)}},Sections={add:function(){swal.setDefaults({input:"text",confirmButtonText:"Next &rarr;",showCancelButton:!0,animation:!1,progressSteps:["1","2","3"]});swal.queue([{title:"Nombre del sector"},"Codigo del Sector"]).then(function(e){swal.resetDefaults(),function(e){var a="nombre="+e[0]+"&codigo_area="+e[1];a+="&tabla=secciones",new Promise(function(e){if(connectAndSend("process/add",!0,!1,null,a,Sections.getAll,heavyLoad))return e()})}(e)})},getIps:function(){var e=$("#select-sector").val();if($(".print-table").attr("href",BASE_URL+"process/getreport/secciones/"+e),null!=e){var a="tabla=ips&id="+e;connectAndSend("process/getall",!1,null,sectionTable.refresh,a,null)}},getAll:function(){connectAndSend("process/getall",!1,null,function(e){$("#select-sector").html(e)},"tabla=secciones",heavyLoad)},updateIpState:function(e){form="data="+JSON.stringify(e)+"&extra_info="+JSON.stringify({module:"ip"}),axios.post(BASE_URL+"process/axiosupdate",form).then(function(e){displayMessage(e.data.mensaje)})}},Extras={remove:function(e){var a,t;a=$("#detail-client-id").val(),form="data="+JSON.stringify({id:e,id_cliente:a}),(t=axios.post(BASE_URL+"extra/delete_extra",form)).then(function(e){var a=e.data;displayMessage(a.mensaje),extraTable.refresh(a.extras)}),t.catch(function(e){console.log(e)})}};